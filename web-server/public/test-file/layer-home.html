<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>layer-home</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <style type="text/css">
        body{
            padding-top:60px;
            padding-bottom:40px;
        }
    </style>
    <link rel='stylesheet' href='../css/style.css' />
    <link href="../css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="../js/lib/bootstrap-table.min.css">
    <script src="../js/base.js"></script>

</head>
<body>

<!--页面内容-->
<div id="container">

    <!--顶部栏目-->
    <div class="navbar navbar-fixed-top" style="float:left;">
        <img src="../img/head1.gif" alt="head" style="width:100%;height:120px;">
        <div style="margin-left:50px;margin-top:-120px;font-size:100px"><i>U-BACKUP</i><span style="font-size:50px;">  管理系统</span></div>
        <div class="navbar-inner" style="background:black;margin-top:-25px">
            <div class="container">
                <div class="nav-collapse" ><br/>
                    <p style="float:left"><a id="top_bar1">U-BackUp管理系统&nbsp&nbsp</a></p>
                    <a id="userName" style="float:left;margin:0 30px"></a>
                    <a id="home" style="float:left;margin-right:30px">主页</a>
                    <a id="setup" style="float:left;margin-right:30px">设置任务</a>
                    <a id="supervise_task">监控任务</a>
                    <a id="top_bar3" style="float:right;">注销</a>
                </div>
            </div>
        </div>
    </div>

    <!--退出确认框（隐含）,需点击显示-->
    <div id='Out' style="height:100px;width:200px;background-color:#0c84e4;margin-left:1218px;margin-top:75px;display:none;position:absolute;z-index:1">
        <div style="text-align: center;margin-top:2px;"><img src="../img/head.jpg" height="20" width="20"></div>
        <div><p style="text-align:center;margin:8px;color:white">确认退出？</p></div>
        <div>
            <div><button id="YesOut" style="float:left;margin:0 25px;">确定</button></div>
            <div><button id="NoOut" style="float:right;margin:0 25px;">取消</button></div>
        </div>
    </div>

    <!--正文-->
    <div  style="margin-top:60px;width:100%;float:left;background-color:#f9f9f9">

        <!--系统设备文件容器-->
        <div style="float:left;margin-left:5%;margin-right:70px;margin-top:100px;width:42.5%">

            <!--系统容器-->
            <div id="system" class="hero-unit jumbotron" style="padding-top:10px;padding-bottom:10px;">
                <div style="position:relative;margin-left:10px">

                    <div style="margin:10px 10px;">
                        <div style="float:left">
                            <select id='systemChoose'>
                                <option>-- 请选择系统 --</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-left:180px">
                        <button type="button" class="btn btn-info btn-sm" style="margin-right:20px" data-toggle="modal" data-target="#checkSystem">查看系统</button>
                        <div class="modal fade" id="checkSystem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;"><b style="float:left;">系统名字:&nbsp</b><b id="check_systemName" style="color:blue;">-- 请选择系统 --</b></div>
                                    <div class="modal-body">
                                        <p><b>systemID:&nbsp</b><b id="check_systemID" style="color:blue;"></b></p>
                                        <p><b>系统描述:&nbsp</b><b id="check_systemDescribe" style="color:blue;"></b></p>
                                        <p><b>从属于:&nbsp</b><b id="check_userID" style="color:blue;"></b></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button type="button" class="btn btn-info btn-sm" style="margin-right:20px" data-toggle="modal" data-target="#modifySystem">修改系统</button>
                        <div class="modal fade" id="modifySystem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;">
                                        <div><b>系统名:&nbsp</b><b id="old_systemName" style="color:blue;">-- 请选择系统 --</b></div>
                                        <div id="noChooseSyetem" ><b style="color:red;display:none;">未选择系统则无法修改系统</b></div>
                                        <div><b>系统描述:&nbsp</b><b id="old_systemDescribe" style="color:blue;"></b></div>
                                    </div>
                                    <div class="modal-body">
                                        <p style='color:red'>只允许修改系统描述！</p>
                                        <!--<p><b>新系统名:&nbsp</b><input id="modify_systemName" style="color:blue;"></p>-->
                                        <p><b>新系统描述:&nbsp</b><input id="modify_systemDescribe" style="color:blue;"></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="modify_system_confirm"  type="button" class="btn btn-info" data-dismiss="modal">确认修改</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button type="button" class="btn btn-info btn-sm" style="margin-right:20px" data-toggle="modal" data-target="#addSystem">添加系统</button>
                        <div class="modal fade" id="addSystem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;"><b style="float:left;">系统名:&nbsp</b><input id="add_systemName" style="color:blue;">*<button id="deleteSystemData" style="font-size:15px;margin-left:30px">清除数据</button></div>
                                    <div class="modal-body">
                                        <!--<p><b>systemID:&nbsp</b><b id="add_systemID" style="color:blue;">自动生成添加</b></p>-->
                                        <p><b>系统描述:&nbsp</b><input type="text" id="add_systemDescribe" style="color:blue;"></p>
                                        <p><b>从属于:&nbsp</b><b id="add_userID" style="color:blue;"></b></p>
                                        <p style="font-size:20px;color:red">注意：*号为必填项</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="add_confirm" type="button" class="btn btn-info" data-dismiss="modal">确定添加</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="systemdelete" type="button" class="btn btn-info btn-sm" style="margin-right:20px" data-toggle="modal" data-target="#deleteSystem">删除系统</button>
                        <div class="modal fade" id="deleteSystem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;text-align: center;"><b style="float:left;">删除整个系统？</b></div>
                                    <div class="modal-body">
                                        <p><b>此操作将删除这个系统下所有设备以及文件，且不能恢复，请谨慎操作！</b></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="delete_system_confirm" type="button" class="btn btn-info" data-dismiss="modal">确定删除</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                    </div>

                </div>
            </div><br/>

            <!--设备容器-->
            <div id="device" class="hero-unit jumbotron" style="padding-top:10px;padding-bottom:10px;">
                <div style="position:relative;margin-left:10px">

                    <div style="margin:10px 10px;">
                        <div style="float:left">
                            <select id="deviceChoose" >
                                <option>-- 请选择设备 --</option>
                                <!--默认选中，动态生成option -->
                            </select>
                        </div>
                    </div>

                    <div style="margin-left:180px">
                        <button id="devicecheck" type="button" class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#checkDevice">查看设备</button>
                        <div class="modal fade" id="checkDevice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;"><b style="float:left;">设备名称:&nbsp</b><b id="check_deviceName" style="color:blue;">-- 请选择设备 --</b></div>
                                    <div class="modal-body">
                                        <p><b>deviceID:&nbsp</b><b id="check_deviceID" style="color:blue;"></b></p>
                                        <p><b>设备描述:&nbsp</b><b id="check_deviceDescribe" style="color:blue;"></b></p>
                                        <p><b>设备类型:&nbsp</b><b id="check_deviceType" style="color:blue;"></b></p>
                                        <!--<p><b>设备状态:&nbsp</b><b id="check_deviceState" style="color:blue;"></b></p>-->
                                        <p><b>设备IP地址:&nbsp</b><b id="check_deviceIpAddress" style="color:blue;"></b></p>
                                        <p><b>设备用户名:&nbsp</b><b id="check_deviceUserName" style="color:blue;"></b></p>
                                        <p><b>设&nbsp备&nbsp密&nbsp码:&nbsp</b><b id="check_devicePassword" style="color:blue;"></b></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="devicemodify" type="button"  class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#modifyDevice">修改设备</button>
                        <div class="modal fade" id="modifyDevice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;">
                                        <div><b>设备名:&nbsp</b><b id="old_deviceName" style="color:blue;">-- 请选择设备 --</b></div>
                                        <div><b>设备描述:&nbsp</b><b id="old_deviceDescribe" style="color:blue;"></b></div>
                                    </div>
                                    <div class="modal-body">
                                        <p style='color:red'>只允许修改设备描述！</p>
                                        <!--<p><b>新设备名:&nbsp</b><input id="modify_deviceName" style="color:blue;"></p>-->
                                        <p><b>新设备描述:&nbsp</b><input id="modify_deviceDescribe" style="color:blue;"></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="modify_device_confirm"  type="button" class="btn btn-info" data-dismiss="modal">确认修改</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="deviceadd" type="button" class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#addDevice">添加设备</button>
                        <div class="modal fade" id="addDevice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;"><b style="float:left;">设备名:&nbsp</b><input id="add_deviceName" style="color:blue;">*<button id="deleteDeviceData" style="font-size:15px;margin-left:30px">清除数据</button></div>
                                    <div class="modal-body">
                                        <p><b>deviceID:&nbsp</b><b id="add_deviceID" style="color:blue;">自动生成添加</b></p>
                                        <p><b>设备描述:&nbsp</b><input id="add_deviceDescribe" style="color:blue;"></p>
                                        <p><b>设备类型:&nbsp</b>
                                            <select id="add_deviceType" style="color:blue;font-size:15px">
                                                <option>设备类型</option>
                                                <option>主机</option>
                                                <option>路由器</option>
                                            </select>*
                                            <!--</p>主机为0，路由器为1-->
                                        <p><b>设备IP地址:&nbsp</b><input id="add_deviceipAddress" style="color:blue;">*</p>
                                        <p id="IPwrong" style="font-size:15px;color:red;display:none">IP地址输入错误！</p>
                                        <p><b>设备用户名:&nbsp</b><input id="add_deviceUserName" style="color:blue;">*</p>
                                        <p><b>设备密码:&nbsp</b><input id="add_devicePassword" style="color:blue;">*</p>
                                        <p style="font-size:20px;color:red">注意：*号为必填项</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="add_device_confirm" type="button" class="btn btn-info" data-dismiss="modal">确定添加</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="devicedelete" type="button" class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#deleteDevice">删除设备</button>
                        <div class="modal fade" id="deleteDevice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;text-align: center;"><b style="float:left;">删除整个设备？</b></div>
                                    <div class="modal-body">
                                        <p><b>此操作将删除这个设备下所有文件，且不能恢复，请谨慎操作！</b></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="delete_device_confirm" type="button" class="btn btn-info" data-dismiss="modal">确定删除</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                    </div>

                </div>
            </div><br/>

            <!--文件容器-->
            <div id="file" class="hero-unit jumbotron" style="padding-top:10px;padding-bottom:10px;">
                <div style="position:relative;margin-left:10px">

                    <div style="margin:10px 10px;">
                        <div style="float:left">
                            <select id="fileChoose" >
                                <option>-- 请选择文件 --</option>
                                <!--默认选中，动态生成option -->
                            </select>
                        </div>
                    </div>

                    <div style="margin-left:180px;">
                        <button id="filecheck" type="button" class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#checkFile">查看文件</button>
                        <div class="modal fade" id="checkFile" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;"><b style="float:left;">文件名:&nbsp</b><b id="check_fileName" style="color:blue;">-- 请选择文件 --</b></div>
                                    <div class="modal-body">
                                        <p><b>fileID:&nbsp</b><b id="check_fileID" style="color:blue;"></b></p>
                                        <p><b>文件描述</b>:&nbsp</b><b id="check_fileDescribe" style="color:blue;"></b></p>
                                        <!--<p><b>fileType:&nbsp</b><b id="check_fileType" style="color:blue;"></b></p>-->
                                        <!--<p><b>fileState:&nbsp</b><b id="check_fileState" style="color:blue;"></b></p>-->
                                        <p><b>文件远程地址:&nbsp</b><b id="check_fileabsoluteAddress" style="color:blue;"></b></p>
                                        <!--<p><b>filelocalAddress:&nbsp</b><b id="check_filelocalAddress" style="color:blue;"></b></p>-->
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="filemodify" type="button"  class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#modifyFile">修改文件</button>
                        <div class="modal fade" id="modifyFile" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;">
                                        <div><b>文件名:&nbsp</b><b id="old_fileName" style="color:blue;">-- 请选择文件 --</b></div>
                                        <div><b>文件描述:&nbsp</b><b id="old_fileDescribe" style="color:blue;"></b></div>
                                    </div>
                                    <div class="modal-body">
                                        <!--<p style='color:red'>只允许修改文件描述和文件远程路径！</p>-->
                                        <!--<p><b>新文件名:&nbsp</b><input id="modify_fileName" style="color:blue;"></p>-->
                                        <p><b>新文件描述:&nbsp</b><input id="modify_fileDescribe" style="color:blue;"></p>
                                        <p><b>新文件远程路径:&nbsp</b><input id="modify_Remote_file" style="color:blue;"></p>
                                        <!--<p style="font-size:15px;color:red">标注*为必填，主机文件请填写以上三项，路由文件填写下面两项！</p>-->
                                        <p id="modify1"  style="font-size:15px;color:red;display:none">当前选择文件为<b>主机文件</b>，请填写<b>以上两项！</b></p>
                                        <p id="modify2" style="font-size:15px;color:red;display:none">当前选择设备为<b>路由器文件</b>，请填写以下<b>两项！</b></p>
                                        <p><b>路由命令:&nbsp</b><input id="modify_routeCommand" style="color:blue;"></b></p>
                                        <p><b>路由关键字:&nbsp</b><input id="modify_routeKeyword" style="color:blue;"></b></p>

                                    </div>
                                    <div class="modal-footer">
                                        <button id="modify_file_confirm"  type="button" class="btn btn-info" data-dismiss="modal">确认修改</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="fileadd" type="button" class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#addFile">添加文件</button>
                        <div class="modal fade" id="addFile" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div id="addfilename" class="modal-header" style="font-size:25px;"><b style="float:left;">文件名:&nbsp</b><input id="add_fileName" style="color:blue;">*<button id="deleteFileData" style="font-size:15px;margin-left:30px">清除数据</button></div>
                                    <div class="modal-body">
                                        <!--<p><b>fileID:&nbsp</b><b id="add_fileID" style="color:blue;">自动生成添加</b></p>-->
                                        <p><b>文件描述:&nbsp</b><input id="add_fileDescribe" style="color:blue;"></p>
                                        <p><b>文件远程路径:&nbsp</b><input id="add_fileabsoluteAddress" style="color:blue;">*</p>
                                        <!--<p style="font-size:15px;color:red">标注*为必填，主机文件请填写以上三项，路由文件填写下面两项！</p>-->
                                        <p id="device1"  style="font-size:15px;color:red;display:none">当前选择设备为<b>主机</b>设备，添加文件为<b>主机</b>文件，请填写<b>以上三项</b>！标注*为必填!</p>
                                        <p id="device2" style="font-size:15px;color:red;display:none">当前选择设备为<b>路由器</b>设备，添加文件为<b>路由器</b>文件，请填写以下<b>两项</b>！标注*为必填!</p>
                                        <p><b>路由命令:&nbsp</b><input id="add_routeCommand" style="color:blue;"></b>*</p>
                                        <p><b>路由关键字:&nbsp</b><input id="add_routeKeyword" style="color:blue;"></b>*</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="add_file_confirm" type="button" class="btn btn-info" data-dismiss="modal">确定添加</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>
                        <button id="filedelete" type="button" class="btn btn-info btn-sm" disabled="disabled" style="margin-right:20px" data-toggle="modal" data-target="#deleteFile">删除文件</button>
                        <div class="modal fade" id="deleteFile" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="font-size:25px;text-align: center;"><b style="float:left;">删除文件？</b></div>
                                    <div class="modal-body">
                                        <p><b>此操作将删除文件且不能恢复，请谨慎操作！</b></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="delete_file_confirm" type="button" class="btn btn-info" data-dismiss="modal">确定删除</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>

                        <button id="test" class="btn" type="button" class="btn btn-info btn-sm" onclick="update()">测试</button>


                    </div>

                </div>
            </div><br/>

        </div>

        <!--实时状态测试框-->
        <div style="margin-top:100px;margin-left:52.5%;width:42.5%">
            <form role="form">
                <!--<p style="text-align: center">实时动态</p>-->
                <!--<div id="update" style="margin-left:970px;margin-bottom:10px" onclick="update()"><button>刷新</button></div>-->
                <!--<input type="textarea" id="realtime_state" style="background-color:black;width:1080px;height:500px;color:white">-->
                <textarea id="realtime_state" class="form-control" style="background-color:black;height:280px;width:90%;color:white;" disabled="disabled"></textarea>
            </form>
        </div>

    </div>

    <!--页脚内容-->
    <div  class="navbar navbar-default navbar-fixed-bottom" style="background-color:#2e2e2e;">
        <p style="text-align:center;padding-top:15px;color:lightblue"><a href="#">@copyright CXG </a>2017</p>
    </div>

</div>

<button id='b'>click</button>

<!--页面js效果-->
<script src="../js/lib/jquery.min.js"></script>
<!--<script src="../../web-server/node_modules/layui-src/dist/layui.js"></script>-->
<script src="../../node_modules/layui-src/dist/layui.js"></script>

<script>
    var n='OK';
    layer(n);
    function layer(n){
        if(n == 'OK'){
            layui.use(['layer', 'form'], function(){
                var layer = layui.layer,form = layui.form;
                layer.msg('Hello World');
            });
        }
    }
</script>

<script>
    var username;
    var token;
    var userType;
    var httpHost = location.href.replace(location.hash, '');

    function update(){
        var userID = localStorage['userID'];
        setInterval(function(){
            $.post(httpHost + '/../test_backupInfo', {'userID': userID}, function (data) {
                var realtime_state = data.realtime_state[0].realtime_state;
                $("#realtime_state").val(realtime_state);
            })
        },1000)
    }

    window.onload=function() {

        /********************************************************************顶部按钮**************************************************************************/

        $(function () {
            $("[data-toggle='popover']").popover();
        });

        $('#home').on('click', function () {
            window.location.href = '/UserHome.html';
        }).css("cursor", "pointer");

        //顶部的‘设置任务’按钮
        $("#setup").on('click', function () {
            window.location.href = '/Setup.html';
        }).css("cursor", "pointer");

        //顶部栏的‘监控任务’按钮
        $("#supervise_task").on('click',function(){
            window.location.href ='/show_tasks.html';
        }).css("cursor", "pointer");

        //顶部栏的退出框效果
        $('#top_bar3').on('click', function () {
            $('#Out').show();
            $('#YesOut').on('click', function () {
                window.localStorage.removeItem('userName');
                window.localStorage.removeItem('passWord');
                window.localStorage.removeItem('token');
                window.localStorage.removeItem('userType');
                window.localStorage.removeItem('userID');
                window.location.href = '/logout.html';
            });
            $('#NoOut').on('click', function () {
                $('#Out').hide();
            }).css("cursor", "pointer");
        }).css("cursor", "pointer");

        /***************************************************************点击添加下拉框列表*********************************************************************/

        $("#b").on("click",function(){
            layui.use(['layer', 'form'], function(){
                var layer = layui.layer
                        ,form = layui.form;

                layer.msg('Hello World');
            });
        })

            //从本地存储拿到userID，再从数据库中取出此userID下的systems,加入一级列表
        $.post(httpHost + '/../get_FirstDropDownList', {'userID': userID}, function (data) {  //将获取的userid数据库比对，post请求与后台交互拿出此用户下的system,拿出数据后执行function
            var userID = localStorage['userID'];
            var userName = localStorage['userName'];
            $("#check_userID").empty();
            $("#check_userID").append("userName = " + userName + ", userID = " + userID );
            $("#add_userID").empty();
            $("#add_userID").append("userName = " + userName + ", userID = " + userID );
            if (data.code === code.RETURNCODE.NOSYSTEM) {
                console.log("There is no system in this user!")
                //alert("此用户下无系统！")
                return;
            } else if(data.code === code.RETURNCODE.OK){
                //console.log(data.systemName); //将后台返回的数据在控制台里打印出来（返回数据re里面的systemName）
                var systemName = data.systemName; //systemName值为json数组

                $(function(){   //页面加载自动触发函数
                    for(var i=0;i<systemName.length;i++){
                        var systemElement = $(document.createElement("option"));
                        systemElement.attr("value", systemName[i].systemName);
                        systemElement.text(systemName[i].systemName);
                        $("#systemChoose").append(systemElement);
                    }
                })

            }else if(data.code === code.RETURNCODE.DBERROR){
                alert("访问数据库出错，请稍候重试或者刷新页面!")
                console.log("access database error!")
            }
        })

        //先拿到后台返回的systemID,再从数据库中取出此systemID下的devices,加入二级列表，点击“查看系统”查看系统属性
        $("#systemChoose").on("click",function(){
            //点击一级下拉框，则清除二级三级下拉框的内容，根据一级下拉框的选择进行重新加载
            $("#deviceChoose").empty();
            $("#fileChoose").empty();
            $(function(){
                var deviceElement = $(document.createElement("option"));
                deviceElement.attr("value", "-- 请选择设备 --");
                deviceElement.text("-- 请选择设备 --");
                $("#deviceChoose").append(deviceElement);
                $("#filecheck").attr("disabled",true);
                $("#filemodify").attr("disabled",true);
                $("#fileadd").attr("disabled",true);
                $("#filedelete").attr("disabled",true);
                $("#device_backup").attr("disabled",true);
                $("#file_backup").attr("disabled",true);
            })
            $(function(){
                var fileElement = $(document.createElement("option"));
                fileElement.attr("value", "-- 请选择文件 --");
                fileElement.text("-- 请选择文件 --");
                $("#fileChoose").append(fileElement);
            })
            var systemName_selected = $("#systemChoose option:selected").text();
            //console.log("systemName_selected t= " + systemName_selected);
            $("#check_systemName").empty();
            $("#check_systemName").append(systemName_selected);
            $("#old_systemName").empty();
            $("#old_systemName").append(systemName_selected);
            if(systemName_selected != '-- 请选择系统 --'){
                $.post(httpHost + '/../get_systemID', {'userID': userID,'systemName_selected':systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        alert("no systems in this user!")
                        //console.log("此用户下无系统!")
                        return;
                    }else if(data.code === code.RETURNCODE.OK){
                        var systemID=data.systemID[0].systemID;
                        var systemDescribe = data.systemID[0].systemDescribe;
                        //console.log(systemID);
                        //将系统属性值传到页面显示
                        $("#check_systemID").empty();
                        $("#check_systemID").append(systemID);
                        $("#check_systemDescribe").empty();
                        $("#check_systemDescribe").append(systemDescribe);
                        $("#old_systemDescribe").empty();
                        $("#old_systemDescribe").append(systemDescribe);
                        $("#devicecheck").attr("disabled",false);
                        $("#devicemodify").attr("disabled",false);
                        $("#deviceadd").attr("disabled",false);
                        $("#devicedelete").attr("disabled",false);
                        $("#system_backup").attr("disabled",false);
                        //取出二级下拉框的option值，并添加进去
                        $.post(httpHost + '/../get_SecondDropDownList', {'systemID': systemID}, function (data) {
                            if (data.code === code.RETURNCODE.NODEVICENAME) {
                                console.log("no device in this system!")
                                //alert("此系统下无设备!")
                                return;
                            }else if(data.code === code.RETURNCODE.OK){
                                //var systemID=data.systemID;
                                //console.log(systemID);
                                //console.log(data.deviceName);
                                var deviceName = data.deviceName; //deviceName值为json数组
                                //将拿出的device放到下拉列表中
                                //console.log("devicelength3 = " + $("#deviceChoose option").length);
                                $(function(){
                                    //console.log(deviceName);
                                    if(deviceName){  //如果有设备，则将其加入下拉框
                                        for(var i=0;i<deviceName.length;i++){
                                            var deviceElement = $(document.createElement("option"));
                                            deviceElement.attr("value", deviceName[i].deviceName);
                                            deviceElement.text(deviceName[i].deviceName);
                                            $("#deviceChoose").append(deviceElement);
                                        }
                                    }else{
                                        return;
                                    }
                                })
                            }else if(data.code === code.RETURNCODE.DBERROR){
                                alert("访问数据库出错，请稍后重试或者刷新页面!");
                                console.log("access database error!")
                            }
                        })
                        //})
                        //修改systemName和systemDescribe
                        $("#modify_system_confirm").on("click",function(){
                            //var new_systemName = $("#modify_systemName").val();
                            var new_systemDescribe = $("#modify_systemDescribe").val();
                            var userID = localStorage['userID'];
                            //console.log("new_systemName=" + new_systemName);
                            //console.log("new_systemDescribe=" + new_systemDescribe);
                            //console.log("systemID="+systemID);
                            /*$.post(httpHost + '/../reName',{'userID':userID},function(data){  //判断系统名修改后是否重名
                             for(var i=0,j=0;i<data.systemName.length;i++) {
                             if (new_systemName == data.systemName[i].systemName) {
                             j++;
                             }
                             }
                             if(j>0){
                             alert("此userID下systemName重复！请输入其他systemName！");
                             }else{
                             $.post(httpHost + '/../modify_system', {'systemID': systemID,'new_systemName':new_systemName,'new_systemDescribe':new_systemDescribe}, function (data) {*/
                            $.post(httpHost + '/../modify_system', {'systemID': systemID,'new_systemDescribe':new_systemDescribe}, function (data) {
                                if (data.code === code.RETURNCODE.UPDATEFAIL) {
                                    console.log("fail to update system!");
                                    alert("更新失败!")
                                    return;
                                }else if(data.code === code.RETURNCODE.OK){
                                    console.log("update system success!");
                                    alert("修改成功！")
                                    window.location.reload();  //修改成功自动刷新网页
                                    return;
                                }else if(data.code === code.RETURNCODE.DBERROR){
                                    alert("访问数据库出错，请稍后重试或者刷新页面!");
                                    console.log("access database error!")
                                }
                            })
                            //}
                            //})
                        })
                    }else if(data.code === code.RETURNCODE.DBERROR){
                        alert("访问数据库出错，请稍后重试或者刷新页面!")
                        console.log("access database error!")
                    }
                })
            } else{
                $("#devicecheck").attr("disabled",true);
                $("#devicemodify").attr("disabled",true);
                $("#deviceadd").attr("disabled",true);
                $("#devicedelete").attr("disabled",true);
                $("#filecheck").attr("disabled",true);
                $("#filemodify").attr("disabled",true);
                $("#fileadd").attr("disabled",true);
                $("#filedelete").attr("disabled",true);
                $("#system_backup").attr("disabled",true);
                $("#device_backup").attr("disabled",true);
                $("#file_backup").attr("disabled",true);
                return;
            }
        })

        //先拿到后台返回的deviceID等数据,再从数据库中取出此deviceID下的files,加入三级列表，点击“查看设备”查看设备属性
        $("#deviceChoose").on("click",function(){
            //点击二级下拉框，则清除三级下拉框的内容，根据二级下拉框的选择进行重新加载
            $("#fileChoose").empty();
            $(function(){
                var fileElement = $(document.createElement("option"));
                fileElement.attr("value", "-- 请选择文件 --");
                fileElement.text("-- 请选择文件 --");
                $("#fileChoose").append(fileElement);
            })
            var systemName_selected = $("#systemChoose option:selected").text();
            if(systemName_selected!='-- 请选择系统 --'){
                $.post(httpHost + '/../get_systemID', {'userID': userID,'systemName_selected':systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("no system in this user!")
                        return;
                    }else if(data.code === code.RETURNCODE.OK){
                        var systemID=data.systemID[0].systemID;
                        //console.log(systemID);
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        $("#check_deviceName").empty();
                        $("#check_deviceName").append(deviceName_selected);
                        $("#old_deviceName").empty();
                        $("#old_deviceName").append(deviceName_selected);
                        //console.log('dddsystemID = ' + systemID);
                        //console.log(deviceName_selected);
                        if(deviceName_selected!='-- 请选择设备 --'){
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID,'deviceName_selected':deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICEID) {
                                    //console.log("当前系统下无设备!")
                                    console.log("no device in this system!")
                                    return;
                                }else if(data.code === code.RETURNCODE.OK){
                                    //将设备属性值传到页面显示
                                    var deviceID = data.deviceID[0].deviceID;
                                    $("#check_deviceID").empty();
                                    $("#check_deviceID").append(deviceID);

                                    var deviceDescribe = data.deviceDescrib[0].deviceDescrib;
                                    $("#check_deviceDescribe").empty();
                                    $("#check_deviceDescribe").append(deviceDescribe);

                                    $("#old_deviceDescribe").empty();
                                    $("#old_deviceDescribe").append(deviceDescribe);

                                    var deviceType = data.deviceType[0].deviceType;
                                    if(deviceType == 0){
                                        deviceType = '主机';
                                        $("#check_deviceType").empty();
                                        $("#check_deviceType").append(deviceType);
                                    }else{
                                        deviceType = '路由器';
                                        $("#check_deviceType").empty();
                                        $("#check_deviceType").append(deviceType);
                                    }

                                    var deviceState = data.deviceState[0].deviceState;
                                    $("#check_deviceState").empty();
                                    $("#check_deviceState").append(deviceState);

                                    var ipAddress = data.ipAddress[0].ipAddress;
                                    $("#check_deviceIpAddress").empty();
                                    $("#check_deviceIpAddress").append(ipAddress);

                                    var deviceUserName = data.deviceUserName[0].deviceUserName;
                                    $("#check_deviceUserName").empty();
                                    $("#check_deviceUserName").append(deviceUserName);

                                    var devicePassword = data.devicePassword[0].devicePassword;
                                    $("#check_devicePassword").empty();
                                    $("#check_devicePassword").append(devicePassword);

                                    $("#filecheck").attr("disabled", false);
                                    $("#filemodify").attr("disabled", false);
                                    $("#fileadd").attr("disabled", false);
                                    $("#filedelete").attr("disabled", false);
                                    $("#device_backup").attr("disabled", false);

                                    //console.log(deviceID);

                                    //$("#fileChoose").on("click",function(){
                                    //var deviceName_selected = $("#deviceChoose option:selected").text();
                                    //console.log(data.deviceID);
                                    $.post(httpHost + '/../get_ThirdDropDownList', {'deviceID': deviceID}, function (data) {
                                        if (data.code === code.RETURNCODE.NONAME) {
                                            console.log("no device in this system!")
                                            //alert("此设备下无文件!")
                                            return;
                                        } else if(data.code === code.RETURNCODE.OK){
                                            //var deviceID=data.deviceID;
                                            //console.log(data.deviceID);
                                            //console.log(data.deviceName);
                                            var fileName = data.fileName; //fileName值为json数组
                                            //console.log(fileName);
                                            //console.log(fileName.length)

                                            $(function () {
                                                //console.log(fileName);
                                                if (fileName) {  //如果有文件，则将其加入三级下拉框
                                                    for (var i = 0; i < fileName.length; i++) {
                                                        var fileElement = $(document.createElement("option"));
                                                        fileElement.attr("value", fileName[i].fileName);
                                                        fileElement.text(fileName[i].fileName);
                                                        $("#fileChoose").append(fileElement);
                                                    }
                                                } else {
                                                    return;
                                                }
                                            })
                                        }else if(data.code === code.RETURNCODE.DBERROR){
                                            alert("访问数据库出错，请稍后重试或者刷新数据库!")
                                            console.log("access database error!")
                                        }
                                    })
                                    //})
                                    //修改deviceDescribe
                                    $("#modify_device_confirm").on("click", function () {
                                        //var new_deviceName = $("#modify_deviceName").val();
                                        var new_deviceDescribe = $("#modify_deviceDescribe").val();
                                        //console.log("new_deviceName=" + new_deviceName);
                                        //console.log("new_deviceDescribe=" + new_deviceDescribe);
                                        //console.log("deviceID="+deviceID);
                                        //console.log("systemID="+systemID);
                                        /*$.post(httpHost + '/../redeviceName',{'systemID':systemID},function(data) {  //判断设备修改后是否重名
                                         for (var i = 0, j = 0; i < data.deviceName.length; i++) {
                                         if (new_deviceName == data.deviceName[i].deviceName) {
                                         j++;
                                         }
                                         }
                                         if (j > 0) {
                                         alert("此systemID下deviceName重复！请输入其他deviceName！");
                                         } else {
                                         $.post(httpHost + '/../modify_device', {'deviceID': deviceID, 'new_deviceName': new_deviceName, 'new_deviceDescribe': new_deviceDescribe}, function (data) {*/
                                        $.post(httpHost + '/../modify_device', {'deviceID': deviceID, 'new_deviceDescribe': new_deviceDescribe}, function (data) {
                                            if (data.code === code.RETURNCODE.UPDATEFAIL) {
                                                alert("修改设备失败!")
                                                console.log("fail to update device!")
                                                return;
                                            } else if(data.code === code.RETURNCODE.OK){
                                                console.log("update device success!");
                                                alert("修改成功！")
                                                window.location.reload();  //修改成功自动刷新网页
                                                return;
                                            }else if(data.code === code.RETURNCODE.DBERROR){
                                                console.log("access database error!")
                                                alert("访问数据库出错，请稍候重试或者刷新页面!")
                                            }
                                        })
                                        //}
                                        //})
                                    })
                                }else if(data.code === data.RETURNCODE.DBERROR){
                                    console.log("access database error!")
                                    alert("访问数据库出错，请稍候重试或者刷新页面!")
                                }
                            })
                        }else{
                            $("#filecheck").attr("disabled",true);
                            $("#filemodify").attr("disabled",true);
                            $("#fileadd").attr("disabled",true);
                            $("#filedelete").attr("disabled",true);
                            $("#device_backup").attr("disabled",true);
                            $("#file_backup").attr("disabled",true);
                            return;
                        }
                    }else if(data.code === data.RETURNCODE.DBERROR){
                        alert("访问数据库出错，请稍后重试或者刷新页面!")
                        console.log("access database error!")
                    }
                })
            }else {
                return;
            }
        })

        //拿到后台返回的fileID等数据，将其显示在“查看文件”里，点击“查看文件”查看文件属性
        $("#fileChoose").on("click",function(){
            var systemName_selected = $("#systemChoose option:selected").text();
            if(systemName_selected!='-- 请选择系统 --'){
                $.post(httpHost + '/../get_systemID', {'userID': userID,'systemName_selected':systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("此用户下无系统!")
                        alert("no systems in this user!")
                        return;
                    }else if(data.code === code.RETURNCODE.OK){
                        var systemID=data.systemID[0].systemID;
                        //console.log(systemID);
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        //console.log('dddsystemID = ' + systemID);
                        //console.log(deviceName_selected);
                        if(deviceName_selected!='-- 请选择设备 --'){
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID,'deviceName_selected':deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICEID) {
                                    console.log("no device in this system!")
                                    alert("此系统下无设备!")
                                    return;
                                }else if(data.code === code.RETURNCODE.OK){
                                    var deviceID=data.deviceID[0].deviceID;
                                    var deviceType=data.deviceID[0].deviceType;
                                    //console.log(data.deviceID);
                                    var fileName_selected = $("#fileChoose option:selected").text();
                                    $("#check_fileName").empty();
                                    $("#check_fileName").append(fileName_selected);
                                    $("#old_fileName").empty();
                                    $("#old_fileName").append(fileName_selected);
                                    if(fileName_selected!='-- 请选择文件 --') {
                                        $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                            if (data.code === code.RETURNCODE.NOFILEID) {
                                                console.log("no file in this device！")
                                                alert("此设备下无文件！")
                                            } else if(data.code === code.RETURNCODE.OK){
                                                var fileID = data.fileDescribe[0].fileID;
                                                console.log(fileID);
                                                $("#check_fileID").empty();
                                                $("#check_fileID").append(fileID);
                                                //将文件属性值传到页面显示
                                                var fileDescribe = data.fileDescribe[0].fileDescribe;
                                                $("#check_fileDescribe").empty();
                                                $("#check_fileDescribe").append(fileDescribe);

                                                $("#old_fileDescribe").empty();
                                                $("#old_fileDescribe").append(fileDescribe);

                                                var remote_path = data.fileDescribe[0].remote_file;
                                                //console.log("fileabsoluteAddress=" + fileabsoluteAddress);
                                                $("#check_fileabsoluteAddress").empty();
                                                $("#check_fileabsoluteAddress").append(remote_path);

                                                /*var localPath = data.fileDescribe[0].localpath;
                                                 //console.log("filelocalAddress=" + filelocalAddress);
                                                 $("#check_filelocalAddress").empty();
                                                 $("#check_filelocalAddress").append(localPath);*/

                                                $("#file_backup").attr("disabled",false);

                                                //修改文件
                                                $("#filemodify").on("click",function(){
                                                    if(deviceType == 0){  //若设备为主机
                                                        $("#modify_fileDescribe").attr("disabled",false);
                                                        $("#modify_Remote_file").attr("disabled",false);
                                                        $("#modify_routeCommand").attr("disabled",true);
                                                        $("#modify_routeKeyword").attr("disabled",true);
                                                        $("#modify1").show();
                                                        $("#modify2").hide();
                                                        $("#modify_file_confirm").on("click",function(){
                                                            var new_fileName = $("#modify_fileName").val();
                                                            var new_fileDescribe = $("#modify_fileDescribe").val();
                                                            var new_remote_file = $("#modify_Remote_file").val();
                                                            /*console.log("new_fileName=" + new_fileName);
                                                             console.log("new_fileDescribe=" + new_fileDescribe);
                                                             console.log("fileID=" + fileID);*/
                                                            $.post(httpHost + '/../refileName',{'deviceID':deviceID},function(data) {  //判断文件名修改后是否重名
                                                                for (var i = 0, j = 0; i < data.fileName.length; i++) {
                                                                    if (new_fileName == data.fileName[i].fileName) {
                                                                        j++;
                                                                    }
                                                                }
                                                                if (j > 1) {
                                                                    alert("此deviceID下fileName重复！请输入其他fileName！");
                                                                } else {
                                                                    $.post(httpHost + '/../modify_file', {'deviceType':deviceType,'fileID': fileID, 'new_fileName': new_fileName, 'new_fileDescribe': new_fileDescribe,'new_remote_file':new_remote_file}, function (data) {
                                                                        if (data.code === code.RETURNCODE.UPDATEFAIL) {
                                                                            console.log("fail to update file!")
                                                                            alert("修改文件失败!")
                                                                            return;
                                                                        } else if(data.code === code.RETURNCODE.OK){
                                                                            console.log("update file success!");
                                                                            alert("修改文件成功！")
                                                                            window.location.reload();  //修改成功自动刷新网页
                                                                            return;
                                                                        }else if(data.code === code.RETURNCODE.DBERROR){
                                                                            console.log("acess database error!")
                                                                            alert("访问数据库出错，请稍候重试或者刷新页面!")
                                                                        }
                                                                    })
                                                                }
                                                            })
                                                        })
                                                    }else if(deviceType == 1){  //若是路由器文件
                                                        $("#modify_fileDescribe").attr("disabled",true);
                                                        $("#modify_Remote_file").attr("disabled",true);
                                                        $("#modify_routeCommand").attr("disabled",false);
                                                        $("#modify_routeKeyword").attr("disabled",false);
                                                        $("#modify1").hide();
                                                        $("#modify2").show();
                                                        $("#modify_file_confirm").on("click",function() {
                                                            var new_fileName = $("#modify_fileName").val();
                                                            var new_routeCommand = $("#modify_routeCommand").val();
                                                            var new_routeKeyword = $("#modify_routeKeyword").val();

                                                            $.post(httpHost + '/../modify_file', {'deviceType':deviceType,'fileID': fileID, 'new_fileName': new_fileName, 'new_routeCommand': new_routeCommand, 'new_routeKeyword': new_routeKeyword}, function (data) {
                                                                if (data.code === code.RETURNCODE.UPDATEFAIL) {
                                                                    console.log("fail to update Routefile!")
                                                                    alert("修改文件失败!")
                                                                    return;
                                                                } else if(data.code === code.RETURNCODE.OK){
                                                                    console.log("update Routefile success!");
                                                                    alert("修改文件成功！")
                                                                    //window.location.reload();  //修改成功自动刷新网页
                                                                    return;
                                                                }else if(data.code === code.RETURNCODE.DBERROR){
                                                                    console.log("acess database error!")
                                                                    alert("访问数据库出错，请稍候重试或者刷新页面!")
                                                                }
                                                            })
                                                        })
                                                    }
                                                })
                                            }else if(data.code === code.RETURNCODE.DBERROR){
                                                alert("数据库出错，请稍后重试或者刷新页面！")
                                                console.log("access database error!")
                                            }
                                        })
                                    }else{
                                        $("#file_backup").attr("disabled",true);
                                    }
                                }else if(data.code === data.RETURNCODE.DBERROR){
                                    alert("访问数据库出错，请稍后重试或者刷新页面!")
                                    console.log("access database error!")
                                }
                            })
                        } else{
                            return;
                        }
                    }else if(data.code === data.RETURNCODE.DBERROR){
                        alert("访问数据库出错，请稍候重试或者刷新页面!")
                        console.log("access database error!")
                    }
                })
            }
            else{
                return;
            }
        })

        /*************************************************************添加系统、设备、文件********************************************************************/

            //添加系统，并将系统添加入数据库
        $("#add_confirm").on("click",function(){
            var new_systemName = $("#add_systemName").val();
            var new_systemDescribe = $("#add_systemDescribe").val();
            var userID = localStorage['userID'];
            var userName = localStorage['userName'];
            if(!new_systemName){
                alert("请输入systemName！");
            }else{
                $.post(httpHost + '/../reName',{'userID':userID},function(data){//判断是否重名
                    if(data.code === code.RETURNCODE.OK){    //若用户下有系统存在
                        for(var i=0,j=0;i<data.systemName.length;i++) {
                            if (new_systemName == data.systemName[i].systemName) {
                                j++;
                            }
                        }
                        if(j>0){
                            alert("当前用户下 系统名（systemName） 重复！请更改 系统名（systemName）！");
                        }else{
                            $.post(httpHost + '/../newSystemName',{'new_systemName':new_systemName,'new_systemDescribe':new_systemDescribe,'userID':userID,'userName':userName},function(data){
                                if (data.code === code.RETURNCODE.OK) {
                                    alert("添加系统成功！");
                                    $(function(){
                                        var systemElement = $(document.createElement("option"));
                                        systemElement.attr("value", new_systemName);
                                        systemElement.text(new_systemName);
                                        $("#systemChoose").append(systemElement);
                                    })
                                    //window.location.reload();
                                }else if(data.code === code.RETURNCODE.FAIL){
                                    alert("添加系统失败，请重试！");
                                    console.log("add system fail!")
                                }
                            })
                        }
                    }else if(data.code === code.RETURNCODE.FAIL){  //若用户下没有系统存在
                        $.post(httpHost + '/../newSystemName',{'new_systemName':new_systemName,'new_systemDescribe':new_systemDescribe,'userID':userID,'userName':userName},function(data){
                            if (data.code === code.RETURNCODE.OK) {
                                alert("添加系统成功！");
                                $(function(){
                                    var systemElement = $(document.createElement("option"));
                                    systemElement.attr("value", new_systemName);
                                    systemElement.text(new_systemName);
                                    $("#systemChoose").append(systemElement);
                                })
                                window.location.reload();
                            }else if(data.code === code.RETURNCODE.FAIL){
                                alert("添加系统失败，请重试！");
                                console.log("add system fail!")
                            }
                        })
                    }else  if(data.code === code.RETURNCODE.DBERROR){
                        console.log("access database error");
                        alert("访问数据库出错，请稍候重试或者刷新页面!")
                    }
                })
            }
        })

        //添加设备，并将设备添加入数据库
        $("#add_device_confirm").on("click",function(){
            var systemName_selected = $("#systemChoose option:selected").text();
            var new_deviceName = $("#add_deviceName").val();
            var new_deviceDescribe = $("#add_deviceDescribe").val();
            var new_deviceType = $("#add_deviceType option:selected").text();
            var new_deviceipAddress = $("#add_deviceipAddress").val();
            var new_deviceUserName = $("#add_deviceUserName").val();
            var new_devicePassword = $("#add_devicePassword").val();
            var userID = localStorage['userID'];
            var userName = localStorage['userName'];
            //先取得systemID
            if(new_deviceType == '设备类型'){
                alert("请选择设备类型！")
            }else{
                if(new_deviceType == '主机'){
                    new_deviceType = 2;
                }else if(new_deviceType == '路由器'){
                    new_deviceType = 1;
                }
                //console.log("new_deviceType = " + new_deviceType);

                var reg =  /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/ //正则表达式判断IP地址格式是否正确
                if(reg.test(new_deviceipAddress)) {

                    if(systemName_selected != '-- 请选择系统 --') {
                        $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                            if (data.code === code.RETURNCODE.NOSYSTEMID) {
                                console.log("There is no system in this user!")
                                return;
                            } else if(data.code === code.RETURNCODE.OK){
                                var systemID = data.systemID[0].systemID;
                                //var systemDescribe = data.systemID[0].systemDescribe;
                                //console.log(systemID);
                                if(!new_deviceName){
                                    alert("请输入deviceName！");
                                }else{
                                    $.post(httpHost + '/../redeviceName',{'systemID':systemID},function(data){  //判断是否重名
                                        //console.log(data.deviceName);
                                        //console.log("data.length="+data.deviceName.length);
                                        if(data.code === code.RETURNCODE.OK){  //若系统下有设备存在
                                            for(var i=0,j=0;i<data.deviceName.length;i++) {
                                                if (new_deviceName == data.deviceName[i].deviceName) {
                                                    j++;
                                                }
                                            }
                                            if(j>0){
                                                alert("此系统下设备名重复！请输入其他设备名！");
                                            }else{
                                                /*console.log("new_deviceName = " + new_deviceName);
                                                 console.log("new_deviceType = " + new_deviceType);
                                                 console.log("new_deviceipAddress = " + new_deviceipAddress);
                                                 console.log("new_deviceUserName = " + new_deviceUserName);
                                                 console.log("new_devicePassword = " + new_devicePassword);*/
                                                if(!new_deviceType||!new_deviceName||!new_deviceipAddress||!new_deviceUserName||!new_devicePassword){
                                                    console.log("new_deviceType = " + new_deviceType);
                                                    alert("请按*号标注填写完整！");
                                                }else{
                                                    if(new_deviceType == 2) {
                                                        new_deviceType = 0;
                                                    }
                                                    $.post(httpHost + '/../newDeviceName',{'new_deviceName':new_deviceName,'new_deviceDescribe':new_deviceDescribe,'new_deviceType':new_deviceType,'new_deviceipAddress':new_deviceipAddress,'new_deviceUserName':new_deviceUserName,'new_devicePassword':new_devicePassword,'systemID':systemID,'systemName_selected': systemName_selected,'userName':userName},function(data){
                                                        if (data.code === code.RETURNCODE.OK) {
                                                            alert("添加设备成功！");
                                                            //window.location.reload();
                                                            $(function(){
                                                                var deviceElement = $(document.createElement("option"));
                                                                deviceElement.attr("value", new_deviceName);
                                                                deviceElement.text(new_deviceName);
                                                                $("#deviceChoose").append(deviceElement);
                                                            })
                                                        }else if(data.code === code.RETURNCODE.NAMEEXIST){
                                                            console.log(data.code);
                                                            alert("请更换设备名！");
                                                        }else if(data.code === code.RETURNCODE.DBERROR){
                                                            alert("添加设备失败，请稍候再试！");
                                                        }
                                                    })
                                                }
                                            }
                                        }else if(data.code === code.RETURNCODE.FAIL){  //若系统下没有设备存在
                                            if(!new_deviceType||!new_deviceName||!new_deviceipAddress||!new_deviceUserName||!new_devicePassword){
                                                console.log("new_deviceType = " + new_deviceType);
                                                alert("请按*号标注填写完整！");
                                            }else{
                                                if(new_deviceType == 2) {
                                                    new_deviceType = 0;
                                                }
                                                $.post(httpHost + '/../newDeviceName',{'new_deviceName':new_deviceName,'new_deviceDescribe':new_deviceDescribe,'new_deviceType':new_deviceType,'new_deviceipAddress':new_deviceipAddress,'new_deviceUserName':new_deviceUserName,'new_devicePassword':new_devicePassword,'systemID':systemID,'systemName_selected': systemName_selected,'userName':userName},function(data){
                                                    if (data.code === code.RETURNCODE.OK) {
                                                        alert("添加设备成功！");
                                                        //window.location.reload();
                                                        $(function(){
                                                            var deviceElement = $(document.createElement("option"));
                                                            deviceElement.attr("value", new_deviceName);
                                                            deviceElement.text(new_deviceName);
                                                            $("#deviceChoose").append(deviceElement);
                                                        })
                                                    }else if(data.code === code.RETURNCODE.NAMEEXIST){
                                                        console.log(data.code);
                                                        alert("请更换设备名！");
                                                    }else if(data.code === code.RETURNCODE.DBERROR){
                                                        alert("添加设备失败，请稍候再试！");
                                                    }
                                                })
                                            }
                                        }else  if(data.code === code.RETURNCODE.DBERROR){
                                            alert("访问数据库出错，请稍后再试或者刷新页面！")
                                            console.log("access database error!")
                                        }
                                    })
                                }
                            }else if(data.code === code.RETURNCODE.DBERROR){
                                alert("访问数据库出错，请稍后再试或者刷新页面！")
                                console.log("access database error!")
                            }
                        })
                    }
                }else{
                    $("#IPwrong").show();
                    alert("IP输入有误！");
                }
            }

        })

        //添加文件，并将设备添加入数据库
        $("#add_file_confirm").on("click",function(){
            var systemName_selected = $("#systemChoose option:selected").text();
            var deviceName_selected = $("#deviceChoose option:selected").text();
            var new_fileName = $("#add_fileName").val();
            var new_fileDescribe = $("#add_fileDescribe").val();
            //var new_fileType = $("#add_fileType option:selected").text();
            var new_remote_file = $("#add_fileabsoluteAddress").val();
            //var new_local_path = $("#add_filelocalAddress").val();
            var new_routeCommand = $("#add_routeCommand").val();
            var new_routeKeyword = $("#add_routeKeyword").val();
            var userID = localStorage['userID'];
            var userName = localStorage['userName'];
            //先取得deviceID
            if(systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NODEVICENAME) {
                        console.log("no device in this system!")
                        return;
                    } else {
                        var systemID = data.systemID[0].systemID;
                        //var systemDescribe = data.systemID[0].systemDescribe;
                        //console.log(systemID);
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        //console.log(deviceName_selected);
                        if(deviceName_selected!='-- 请选择设备 --') {
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID, 'deviceName_selected': deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICENAME) {
                                    console.log("no device in this system!")
                                    return;
                                } else {
                                    var deviceID = data.deviceID[0].deviceID;
                                    var deviceType = data.deviceID[0].deviceType;
                                    console.log('deviceType=' + deviceType);

                                    if(deviceType == 0){  //如果文件所属的设备为主机
                                        if (!new_fileName) {
                                            alert("请输入fileName！");
                                        } else {
                                            $.post(httpHost + '/../refileName', {'deviceID': deviceID}, function (data) {  //判断是否重名
                                                //console.log(data.fileName);
                                                //console.log("data.length=" + data.fileName.length);
                                                for (var i = 0, j = 0; i < data.fileName.length; i++) {
                                                    if (new_fileName == data.fileName[i].fileName) {
                                                        j++;
                                                    }
                                                }
                                                if (j > 0) {
                                                    alert("此deviceID下fileName 重复！请输入其他fileName！");
                                                } else {
                                                    if(new_remote_file && new_fileName){
                                                        $.post(httpHost + '/../newFileName', {'new_fileName': new_fileName, 'new_fileDescribe': new_fileDescribe, 'new_remote_file': new_remote_file, 'deviceID': deviceID,'systemName':systemName_selected,'deviceName':deviceName_selected,'userName':userName}, function (data) {
                                                            if (data.code === code.RETURNCODE.OK) {
                                                                //alert("添加文件成功！");
                                                                //window.location.reload();
                                                                $(function () {
                                                                    var fileElement = $(document.createElement("option"));
                                                                    fileElement.attr("value", new_fileName);
                                                                    fileElement.text(new_fileName);
                                                                    $("#fileChoose").append(fileElement);
                                                                })
                                                                alert("添加文件成功！");
                                                            } else {
                                                                alert("添加文件失败！");
                                                            }
                                                        })
                                                    }else{
                                                        alert("请按*号标注填写完整！")
                                                    }
                                                }
                                            })
                                        }
                                    } else if(deviceType == 1 ){  //如果文件所属设备为路由器
                                        $.post(httpHost + '/../get_ThirdDropDownList', {'deviceID': deviceID}, function (data) {
                                            if (data.code === code.RETURNCODE.OK) {
                                                alert("此路由器设备下已有文件！一个路由器设备仅需一个文件！");
                                                console.log('deviceType='+deviceType);
                                            } else if(data.code === code.RETURNCODE.NONAME){
                                                console.log("cuowu");
                                                if(new_routeCommand && new_routeKeyword){
                                                    $.post(httpHost + '/../newRouteFile', {'deviceID': deviceID,'systemName':systemName_selected,'deviceName':deviceName_selected,'userName':userName,'new_routeCommand':new_routeCommand,'new_routeKeyword':new_routeKeyword}, function (data) {
                                                        if (data.code === code.RETURNCODE.OK) {
                                                            //alert("添加文件成功！");
                                                            //window.location.reload();
                                                            $(function () {
                                                                var fileElement = $(document.createElement("option"));
                                                                fileElement.attr("value", new_fileName);
                                                                fileElement.text('routeFile');
                                                                $("#fileChoose").append(fileElement);
                                                            })
                                                            alert("添加路由文件成功！");
                                                        } else if(data.code === code.RETURNCODE.DBERROR){
                                                            alert("添加文件失败！");
                                                        }
                                                    })
                                                }else{
                                                    alert("请按*号标注填写完整！");
                                                }
                                            } else if(data.code === code.RETURNCODE.DBERROR){
                                                alert("添加文件错误！请重试！");
                                            }
                                        })
                                    }
                                }
                            })
                        }
                    }
                })
            }
        })

        //根据设备类型的不同，点击“添加文件”按钮显示不同界面
        $("#fileadd").on("click",function(){
            var systemName_selected = $("#systemChoose option:selected").text();
            var deviceName_selected = $("#deviceChoose option:selected").text();
            var userID = localStorage['userID'];
            var userName = localStorage['userName'];
            //先取得deviceID
            if(systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("no device in this system!")
                        return;
                    } else if(data.code === code.RETURNCODE.OK){
                        var systemID = data.systemID[0].systemID;
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        if(deviceName_selected!='-- 请选择设备 --') {
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID, 'deviceName_selected': deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICEID) {
                                    console.log("no device in this system!")
                                    return;
                                } else if(data.code === code.RETURNCODE.OK){
                                    var deviceID = data.deviceID[0].deviceID;
                                    var deviceType = data.deviceID[0].deviceType;
                                    console.log('deviceType='+deviceType);
                                    if(deviceType == 0){  //如果文件所属的设备为主机
                                        $("#add_fileName").attr('disabled',false);
                                        $("#add_fileDescribe").attr('disabled',false);
                                        $("#add_fileabsoluteAddress").attr('disabled',false);
                                        $("#add_routeCommand").attr('disabled',true);
                                        $("#add_routeKeyword").attr('disabled',true);
                                        /*$("#add_fileName").val("");
                                         $("#add_fileDescribe").val("");
                                         $("#add_fileabsoluteAddress").val("");
                                         $("#add_routeCommand").val("");
                                         $("#add_routeKeyword").val("");*/
                                        $("#device1").show();
                                        $("#device2").hide();
                                    }else{  //如果文件所属设备为路由器
                                        $("#add_fileName").attr('disabled',true);
                                        $("#add_fileDescribe").attr('disabled',true);
                                        $("#add_fileabsoluteAddress").attr('disabled',true);
                                        $("#add_routeCommand").attr('disabled',false);
                                        $("#add_routeKeyword").attr('disabled',false);
                                        /*$("#add_fileName").val("");
                                         $("#add_fileDescribe").val("");
                                         $("#add_fileabsoluteAddress").val("");
                                         $("#add_routeCommand").val("");
                                         $("#add_routeKeyword").val("");*/
                                        $("#device2").show();
                                        $("#device1").hide();
                                    }
                                }else if(data.code === code.RETURNCODE.DBERROR){
                                    console.log("access db error!");
                                    alert("访问数据库错误，请稍后再试或者刷新页面！")
                                }
                            })
                        }
                    }else if(data.code === code.RETURNCODE.DBERROR){
                        console.log("access db error!");
                        alert("访问数据库错误，请稍后再试或者刷新页面！")
                    }
                })
            }
        })

        /*************************************************************删除系统、设备、文件*********************************************************************/

            //删除系统，将系统移除出数据库
        $("#delete_system_confirm").on("click",function(){
            var userID = localStorage['userID'];
            var systemName_selected = $("#systemChoose option:selected").text();
            //console.log(systemName_selected);
            //先取得systemID
            if(systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("no device in this system!")
                        return;
                    } else {
                        var systemID = data.systemID[0].systemID;
                        //console.log('systemID 1072 = '+ systemID);

                        $.post(httpHost + '/../get_AlldeviceID', {'systemID': systemID}, function (data) { //system下拿到所有deviceID
                            if (data.code === code.RETURNCODE.FAIL) {   //若系统下无设备
                                console.log("no device in this system!")
                                $.post(httpHost + '/../delete_system', {'systemID': systemID}, function (data) {  //删除系统
                                    if (data.code === code.RETURNCODE.OK) {
                                        console.log("delete whole system success!");
                                        alert("删除系统成功!")
                                        window.location.reload();
                                    }else{
                                        console.log("delete whole system fail!");
                                        alert("删除系统失败!");
                                    }
                                })
                            }else if(data.code === code.RETURNCODE.OK){  //若系统下有设备
                                var deviceIDlength = data.deviceID.length;
                                //console.log(deviceIDlength);
                                for (var i = 0; i < deviceIDlength; i++) {
                                    var deviceID = data.deviceID[i].deviceID;
                                    //console.log('deviceID ' + i + '=' + deviceID);
                                    $.post(httpHost + '/../delete_device', {'deviceID': deviceID}, function (data) { //删除设备及设备下的文件
                                        if (data.code === code.RETURNCODE.OK) {
                                            console.log("delete device success!");
                                            window.location.reload();
                                        } else if (data.code === code.RETURNCODE.FAIL) {
                                            console.log("delete device fail!");
                                        } else {
                                            console.log("delete err!");
                                        }
                                    })
                                }
                                $.post(httpHost + '/../delete_system', {'systemID': systemID}, function (data) {  //删除系统
                                    if (data.code === code.RETURNCODE.OK) {
                                        console.log("delete whole system success!");
                                        alert("删除系统成功!!")
                                        window.location.reload();
                                    }else{
                                        console.log("delete whole system fail!");
                                        alert("删除系统失败!!");
                                    }
                                })
                            }else if(data.code === code.RETURNCODE.ERROR){
                                alert("数据库错误，刷新或重试！");
                                console.log("de error")
                            }
                        })

                    }
                })
            }else{
                console.log("请先选择系统！");
                alert("请先选择系统！");
            }
        })

        //删除设备，将设备移除出数据库
        $("#delete_device_confirm").on("click",function(){
            var userID = localStorage['userID'];
            var systemName_selected = $("#systemChoose option:selected").text();
            var deviceName_selected = $("#deviceChoose option:selected").text();
            //console.log(deviceName_selected);
            //console.log(deviceName_selected);
            //先取得deviceID
            if(systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NODEVICENAME) {
                        console.log("no device in this system!")
                        return;
                    } else {
                        var systemID = data.systemID[0].systemID;
                        //console.log('systemID 1029 = '+ systemID);
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        //console.log('deviceName_selected 1131 = ' + deviceName_selected);
                        if(deviceName_selected!='-- 请选择设备 --') {
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID, 'deviceName_selected': deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICENAME) {
                                    console.log("no device in this system!")
                                    return;
                                }else{
                                    var deviceID = data.deviceID[0].deviceID;
                                    //console.log('deviceID 1139 = ' + deviceID);
                                    $.post(httpHost + '/../delete_device', {'deviceID': deviceID}, function (data) {  //删除设备
                                        if(data.code === code.RETURNCODE.OK){
                                            //$("#deviceChoose option[text='deviceName_selected']").remove();
                                            console.log("成功删除设备!");
                                            alert("成功删除设备!");
                                            window.location.reload();
                                        }else if(data.code === code.RETURNCODE.FAIL){
                                            console.log("删除设备失败，请再试!");
                                            alert("删除设备失败，请再试!");
                                        }else{
                                            console.log("删除设备错误!");
                                            alert("删除设备发生错误!稍后再试！");
                                        }
                                    })
                                }
                            })
                        }else{
                            alert("请先选择设备！");
                            console.log("请先选择设备！");
                        }
                    }
                })
            }
        })

        //删除文件，将文件移除出数据库
        $("#delete_file_confirm").on("click",function(){
            var userID = localStorage['userID'];
            var systemName_selected = $("#systemChoose option:selected").text();
            var deviceName_selected = $("#deviceChoose option:selected").text();
            var fileName_selected = $("#fileChoose option:selected").text();
            //console.log(deviceName_selected);
            //console.log(deviceName_selected);
            //console.log(fileName_selected);
            //先取得deviceID
            if(systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NODEVICENAME) {
                        console.log("no device in this system!")
                        return;
                    } else {
                        var systemID = data.systemID[0].systemID;
                        //console.log(systemID);
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        //console.log(deviceName_selected);
                        if(deviceName_selected!='-- 请选择设备 --') {
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID, 'deviceName_selected': deviceName_selected}, function (data) {
                                if(fileName_selected!='-- 请选择文件 --') {
                                    if (data.code === code.RETURNCODE.NODEVICENAME) {
                                        console.log("no device in this system!")
                                        return;
                                    }else{
                                        var deviceID = data.deviceID[0].deviceID;
                                        //console.log('fileName_selected ='+ fileName_selected);
                                        $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                            if (data.code === code.RETURNCODE.NOFILENAME) {
                                                console.log("no file in this device!")
                                                return;
                                            }else{
                                                var fileID = data.fileID[0].fileID;
                                                $.post(httpHost + '/../delete_file', {'fileID': fileID}, function (data) {  //删除文件
                                                    if(data.code === code.RETURNCODE.OK){
                                                        //$("#fileChoose option[text='fileName_selected']").remove();
                                                        console.log("delete file success!");
                                                        alert("删除文件成功!!");
                                                        window.location.reload();
                                                    }else if(data.code === code.RETURNCODE.FAIL){
                                                        console.log("delete file fail!");
                                                        alert("删除文件失败!!");
                                                    }else{
                                                        console.log("delete err!");
                                                        alert("删除文件发生错误!稍后再试！");
                                                    }
                                                })
                                            }
                                        })
                                    }
                                }else{
                                    console.log("请先选择文件！");
                                    alert("请先选择文件！")
                                }
                            })
                        }
                    }
                })
            }
        })

        /******************************************************************输入备份频率************************************************************************/

            //点击给定的系统备份频率,自定义频率输入框的效果
        $("#system_backup_Frequency").on("click",function(){
            var system_backup_Frequency = $("#system_backup_Frequency option:selected").text();
            if(system_backup_Frequency != '--请选择系统备份频率--'){
                $("#system_selfdefinition_backup_Frequency").val("");
                $("#system_selfdefinition_backup_Frequency").attr('disabled',true);
                $("#backup_system_Frequency_confirm").attr('disabled',true);
                $("#backup_system_Frequency_cancel").attr('disabled',true);
            }else{
                $("#system_selfdefinition_backup_Frequency").attr('disabled',false);
                $("#backup_system_Frequency_confirm").attr('disabled',false);
                $("#backup_system_Frequency_cancel").attr('disabled',false);
            }
        })

        //自定义系统频率框输入确定后，给定的备份频率下拉框的效果
        $("#backup_system_Frequency_confirm").on("click",function(){
            var system_selfdefinition_backup_Frequency = $("#system_selfdefinition_backup_Frequency").val().trim();
            if(system_selfdefinition_backup_Frequency){
                var dis = Math.abs(system_selfdefinition_backup_Frequency - Math.round(system_selfdefinition_backup_Frequency));
                if (dis == 0) {
                    $("#system_selfdefinition_backup_Frequency").attr('disabled',true);
                    $("#system_backup_Frequency").attr('disabled',true);
                    var token_frequency = 0;
                }else{
                    $("#system_selfdefinition_backup_Frequency").val("");
                    var token_frequency = 1;
                    alert("请输入整数的小时数！");
                }
            }else{
                alert("请先输入备份频率！");
            }
        })

        //自定义系统频率框输入取消后，给定的备份频率下拉框的效果
        $("#backup_system_Frequency_cancel").on("click",function(){
            $("#system_selfdefinition_backup_Frequency").attr('disabled',false);
            $("#system_backup_Frequency").attr('disabled',false);
            var token_frequency = 1;
        })

        /***************************************************************************/

        //点击给定的设备备份频率,自定义频率输入框的效果
        $("#device_backup_Frequency").on("click",function(){
            var device_backup_Frequency = $("#device_backup_Frequency option:selected").text();
            if(device_backup_Frequency != '--请选择设备备份频率--'){
                $("#device_selfdefinition_backup_Frequency").val("");
                $("#device_selfdefinition_backup_Frequency").attr('disabled',true);
                $("#backup_device_Frequency_confirm").attr('disabled',true);
                $("#backup_device_Frequency_cancel").attr('disabled',true);
            }else{
                $("#device_selfdefinition_backup_Frequency").attr('disabled',false);
                $("#backup_device_Frequency_confirm").attr('disabled',false);
                $("#backup_device_Frequency_cancel").attr('disabled',false);
            }
        })

        //自定义设备频率框输入确定后，给定的备份频率下拉框的效果
        $("#backup_device_Frequency_confirm").on("click",function(){
            var device_selfdefinition_backup_Frequency = $("#device_selfdefinition_backup_Frequency").val().trim();
            if(device_selfdefinition_backup_Frequency){
                var dis = Math.abs(device_selfdefinition_backup_Frequency - Math.round(device_selfdefinition_backup_Frequency));
                if (dis == 0) {
                    $("#device_selfdefinition_backup_Frequency").attr('disabled',true);
                    $("#device_backup_Frequency").attr('disabled',true);
                    var token_frequency = 0;
                }else{
                    $("#device_selfdefinition_backup_Frequency").val("");
                    var token_frequency = 1;
                    alert("请输入整数的小时数！");
                }
            }else{
                alert("请先输入备份频率！");
            }
        })

        //自定义设备频率框输入取消后，给定的备份频率下拉框的效果
        $("#backup_device_Frequency_cancel").on("click",function(){
            $("#device_selfdefinition_backup_Frequency").attr('disabled',false);
            $("#device_backup_Frequency").attr('disabled',false);
            var token_frequency = 1;
        })

        /***************************************************************************/

        //点击给定的文件备份频率,自定义频率输入框的效果
        $("#file_backup_Frequency").on("click",function(){
            var file_backup_Frequency = $("#file_backup_Frequency option:selected").text();
            if(file_backup_Frequency != '--请选择文件备份频率--'){
                $("#file_selfdefinition_backup_Frequency").val("");
                $("#file_selfdefinition_backup_Frequency").attr('disabled',true);
                $("#backup_file_Frequency_confirm").attr('disabled',true);
                $("#backup_file_Frequency_cancel").attr('disabled',true);
            }else{
                $("#file_selfdefinition_backup_Frequency").attr('disabled',false);
                $("#backup_file_Frequency_confirm").attr('disabled',false);
                $("#backup_file_Frequency_cancel").attr('disabled',false);
            }
        })

        //自定义文件频率框输入确定后，给定的备份频率下拉框的效果
        $("#backup_file_Frequency_confirm").on("click",function(){
            var file_selfdefinition_backup_Frequency = $("#file_selfdefinition_backup_Frequency").val().trim();
            if(file_selfdefinition_backup_Frequency){
                var dis = Math.abs(file_selfdefinition_backup_Frequency - Math.round(file_selfdefinition_backup_Frequency));
                if (dis == 0) {
                    $("#file_selfdefinition_backup_Frequency").attr('disabled',true);
                    $("#file_backup_Frequency").attr('disabled',true);
                    var token_frequency = 0;
                }else{
                    $("#file_selfdefinition_backup_Frequency").val("");
                    var token_frequency = 1;
                    alert("请输入整数的小时数！");
                }
            }else{
                alert("请先输入备份频率！");
            }
        })

        //自定义文件频率框输入取消后，给定的备份频率下拉框的效果
        $("#backup_file_Frequency_cancel").on("click",function(){
            $("#file_selfdefinition_backup_Frequency").attr('disabled',false);
            $("#file_backup_Frequency").attr('disabled',false);
            var token_frequency = 1;
        })

        /******************************************************************输入备份次数************************************************************************/

            //输入系统备份次数，点击确定次数以及取消

        $("#backup_system_times_confirm").on("click",function(){
            var system_backup_times = $("#system_backup_times").val().trim();
            if(system_backup_times){
                var dis = Math.abs(system_backup_times - Math.round(system_backup_times));
                if (dis == 0) {
                    $("#system_backup_times").attr('disabled',true);
                    var token_times = 0;
                }else{
                    $("#system_backup_times").val("");
                    var token_times = 1;
                    alert("请输入整数的次数！");
                }
            }else{
                alert("请先输入备份次数！");
            }
        })

        $("#backup_system_times_cancel").on("click",function(){
            $("#system_backup_times").attr('disabled',false);
            var token_times = 1;
        })

        //输入设备备份次数，点击确定次数以及取消

        $("#backup_device_times_confirm").on("click",function(){
            var device_backup_times = $("#device_backup_times").val().trim();
            if(device_backup_times){
                var dis = Math.abs(device_backup_times - Math.round(device_backup_times));
                if (dis == 0) {
                    $("#device_backup_times").attr('disabled',true);
                    var token_times = 0;
                }else{
                    $("#device_backup_times").val("");
                    var token_times = 1;
                    alert("请输入整数的次数！");
                }
            }else{
                alert("请先输入备份次数！");
            }
        })

        $("#backup_system_times_cancel").on("click",function(){
            $("#system_backup_times").attr('disabled',false);
            var token_times = 1;
        })

        //输入文件备份次数，点击确定次数以及取消

        $("#backup_file_times_confirm").on("click",function(){
            var file_backup_times = $("#file_backup_times").val().trim();
            if(file_backup_times){
                var dis = Math.abs(file_backup_times - Math.round(file_backup_times));
                if (dis == 0) {
                    $("#file_backup_times").attr('disabled',true);
                    var token_times = 0;
                }else{
                    $("#file_backup_times").val("");
                    var token_times = 1;
                    alert("请输入整数的次数！");
                }
            }else{
                alert("请先输入备份次数！");
            }
        })

        $("#backup_file_times_cancel").on("click",function(){
            $("#file_backup_times").attr('disabled',false);
            var token_times = 1;
        })

        /*************************************************************备份系统、设备、文件*********************************************************************/

            //备份系统,将整个系统下的文件写入数据库备份信息（tasks）表
        $("#backup_system_confirm").on("click",function() {
            var system_selfdefinition_backup_Frequency = $("#system_selfdefinition_backup_Frequency").val().trim(); //获取自定义备份频率
            var system_backup_Frequency = $("#system_backup_Frequency option:selected").text();  //获取下拉框选定的备份频率
            var system_times = $("#system_backup_times").val().trim();
            console.log("system_times:"+system_times);
            var userID = localStorage['userID'];
            var systemName_selected = $("#systemChoose option:selected").text();
            if (systemName_selected != '-- 请选择系统 --') {
                if (system_backup_Frequency != '--请选择系统备份频率--' || system_selfdefinition_backup_Frequency) {   //给定频率和自定义频率均为空时；

                    if(system_backup_Frequency != '--请选择系统备份频率--' ){ //给定频率不空，自定义频率为空
                        var system_backup_Frequency_Drop_down = new Array('一周(7D)','一月(30D)','三月(91D)','半年(182D)','一年(365D)');  //将下拉框选定值转化为备份频率数值
                        var system_backup_Frequency_trans = new Array(7,30,91,182,365);
                        for(var z = 0;z<system_backup_Frequency_Drop_down.length;z++){
                            if(system_backup_Frequency == system_backup_Frequency_Drop_down[z]){
                                var system_backup_Frequency_dis = system_backup_Frequency_trans[z];   //备份频率数值
                                break;
                            }
                        }
                        if(system_times) {      //备份次数不空
                            $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NOSYSTEMID) {
                                    console.log("此系统不存在systemID!")
                                    return;
                                } else {
                                    var systemID = data.systemID[0].systemID;
                                    //console.log('systemID 1239 = '+ systemID);
                                    $.post(httpHost + '/../get_AlldeviceID', {'systemID': systemID}, function (data) { //通过systemID拿到所有deviceID
                                        //console.log(data.deviceID);
                                        var deviceIDlength = data.deviceID.length;
                                        console.log("deviceIDlength 1830 = " + deviceIDlength);
                                        if (deviceIDlength == 0) {
                                            console.log("此系统无设备，无需备份！");
                                            alert("此系统下无设备，无需备份！");
                                        } else {   //系统下有设备的备份情况
                                            var deviceID = data.deviceID;
                                            $.each(deviceID, function (i, deviceID) {   //此处循环不可用for，while，因为它们发生了异步请求之后，会导致所有异步请求成功之后的deviceID都是最后一条数据。
                                                var deviceID = data.deviceID[i].deviceID;
                                                var deviceName = data.deviceID[i].deviceName;
                                                var deviceType = data.deviceID[i].deviceType;
                                                var host = data.deviceID[i].ipAddress;
                                                var host_user = data.deviceID[i].deviceUserName;
                                                var password = data.deviceID[i].devicePassword;
                                                $.post(httpHost + '/../get_AllfileID', {'deviceID': deviceID}, function (data) { //device下拿到所有fileID
                                                    if (data.code == code.RETURNCODE.OK) {
                                                        var fileIDlength = data.fileID.length;
                                                        console.log("i= " + i);
                                                        console.log('deviceID[' + i + '] = ' + deviceID + "," + "fileIDlength = " + fileIDlength);
                                                        if (fileIDlength == 0) {
                                                            console.log("此设备下没有文件，仅作设备备份!");
                                                            //alert("此设备下没有文件，无需备份!");
                                                            /*$.post(httpHost + '/../check_deviceID', {'deviceID': deviceID}, function (data) {  //检查是否有重复的且状态为未备份的设备记录
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             $.post(httpHost + '/../delete_tasks_deviceID', {'deviceID': deviceID}, function (data) {  //若有状态为未备份的重复设备，则删除旧的设备备份策略
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             var oDate = new Date();
                                                             for(var i = 0;i < system_times; i++){
                                                             oDate.setTime(oDate.getTime() + system_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                             var year = oDate.getFullYear();   //获取系统的年；
                                                             var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                             var day = oDate.getDate(); // 获取系统日，
                                                             var hour = oDate.getHours(); //获取系统时，
                                                             var minute = oDate.getMinutes(); //分
                                                             var second = oDate.getSeconds(); //秒
                                                             if(month < 10){
                                                             var month = '0' + month.toString();
                                                             }
                                                             if(day < 10){
                                                             var day = '0' + day.toString();
                                                             }
                                                             if(hour < 10){
                                                             var hour = '0' + hour.toString();
                                                             }
                                                             if(minute < 10){
                                                             var minute = '0' + minute.toString();
                                                             }
                                                             if(second < 10){
                                                             var second = '0' + second.toString();
                                                             }
                                                             var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                             console.log(task_time);
                                                             $.post(httpHost + '/../write_deviceID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'task_time': task_time,'host':host,'host_user':host_user,'password':password}, function (data) {  //删除旧的设备备份策略后，写入新的设备备份策略
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             console.log("userID = " + userID + ";" + "systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略成功！");
                                                             //alert("在备份表上写入新的设备备份策略成功！");
                                                             } else {
                                                             console.log("userID = " + userID + ";" + "systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略失败！");
                                                             //alert("在备份表上写入新的设备备份策略失败！");
                                                             }
                                                             })
                                                             month = parseInt(month);
                                                             day = parseInt(day);
                                                             hour = parseInt(hour);
                                                             minute = parseInt(minute);
                                                             second = parseInt(second);
                                                             }
                                                             } else {
                                                             console.log("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                             //alert("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                             }
                                                             })
                                                             } else {   //若表上设备未备份记录不存在，则直接写入
                                                             var oDate = new Date();
                                                             for(var i = 0;i < system_times; i++){
                                                             oDate.setTime(oDate.getTime() + system_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                             var year = oDate.getFullYear();   //获取系统的年；
                                                             var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                             var day = oDate.getDate(); // 获取系统日，
                                                             var hour = oDate.getHours(); //获取系统时，
                                                             var minute = oDate.getMinutes(); //分
                                                             var second = oDate.getSeconds(); //秒
                                                             if(month < 10){
                                                             var month = '0' + month.toString();
                                                             }
                                                             if(day < 10){
                                                             var day = '0' + day.toString();
                                                             }
                                                             if(hour < 10){
                                                             var hour = '0' + hour.toString();
                                                             }
                                                             if(minute < 10){
                                                             var minute = '0' + minute.toString();
                                                             }
                                                             if(second < 10){
                                                             var second = '0' + second.toString();
                                                             }
                                                             var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                             console.log(task_time);
                                                             $.post(httpHost + '/../write_deviceID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'task_time': task_time,'host':host,'host_user':host_user,'password':password}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             console.log("userID = " + userID + ";" + "systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略成功！");
                                                             //alert("在备份表上写入设备备份策略成功！");
                                                             } else {
                                                             console.log("userID = " + userID + ";" + "systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略失败！");
                                                             //alert("在备份表上写入设备备份策略失败！");
                                                             }
                                                             })
                                                             month = parseInt(month);
                                                             day = parseInt(day);
                                                             hour = parseInt(hour);
                                                             minute = parseInt(minute);
                                                             second = parseInt(second);
                                                             }
                                                             }
                                                             })*/
                                                        } else {   //若设备下有文件
                                                            var fileID = data.fileID;
                                                            $.each(fileID, function (j, fileID) {
                                                                var fileID = data.fileID[j].fileID;
                                                                var fileName = data.fileID[j].fileName;
                                                                var remote_file = data.fileID[j].remote_file;
                                                                var local_path = data.fileID[j].local_path;
                                                                var route_command = data.fileID[j].route_command;
                                                                var route_keywords = data.fileID[j].route_keywords;
                                                                console.log('fileID [' + j + '] = ' + fileID);
                                                                $.post(httpHost + '/../check_fileID', {'fileID': fileID}, function (data) {  //检查是否有重复备份记录
                                                                    if (data.code == code.RETURNCODE.OK) {
                                                                        $.post(httpHost + '/../delete_tasks_fileID', {'fileID': fileID}, function (data) {   //若有未备份的重复文件，则先进行删除文件记录，再写入文件记录
                                                                            if (data.code == code.RETURNCODE.OK) {
                                                                                var oDate = new Date();
                                                                                for(var i = 0;i < system_times; i++){
                                                                                    oDate.setTime(oDate.getTime() + system_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                                                    var year = oDate.getFullYear();   //获取系统的年；
                                                                                    var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                                    var day = oDate.getDate(); // 获取系统日，
                                                                                    var hour = oDate.getHours(); //获取系统时，
                                                                                    var minute = oDate.getMinutes(); //分
                                                                                    var second = oDate.getSeconds(); //秒
                                                                                    if(month < 10){
                                                                                        var month = '0' + month.toString();
                                                                                    }
                                                                                    if(day < 10){
                                                                                        var day = '0' + day.toString();
                                                                                    }
                                                                                    if(hour < 10){
                                                                                        var hour = '0' + hour.toString();
                                                                                    }
                                                                                    if(minute < 10){
                                                                                        var minute = '0' + minute.toString();
                                                                                    }
                                                                                    if(second < 10){
                                                                                        var second = '0' + second.toString();
                                                                                    }
                                                                                    var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                                    console.log(task_time);
                                                                                    console.log("systemName="+systemName_selected);
                                                                                    console.log("deviceName="+deviceName);
                                                                                    console.log("fileName="+fileName);
                                                                                    $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'systemName': systemName_selected,'deviceID': deviceID,'deviceName':deviceName, 'deviceType':deviceType,'fileID':fileID,'fileName':fileName,'task_time': task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                                                        if (data.code == code.RETURNCODE.OK) {
                                                                                            console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                            //alert("在备份表上写入新的文件备份策略成功！");
                                                                                        } else {
                                                                                            console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略失败！");
                                                                                            //alert("在备份表上写入新的文件备份策略成功！");
                                                                                        }
                                                                                    })
                                                                                    month = parseInt(month);
                                                                                    day = parseInt(day);
                                                                                    hour = parseInt(hour);
                                                                                    minute = parseInt(minute);
                                                                                    second = parseInt(second);
                                                                                }
                                                                            } else {
                                                                                console.log("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                                //alert("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                            }
                                                                        })
                                                                    } else {
                                                                        var oDate = new Date();
                                                                        for(var i = 0;i < system_times; i++){
                                                                            oDate.setTime(oDate.getTime() + system_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                                            var year = oDate.getFullYear();   //获取系统的年；
                                                                            var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                            var day = oDate.getDate(); // 获取系统日，
                                                                            var hour = oDate.getHours(); //获取系统时，
                                                                            var minute = oDate.getMinutes(); //分
                                                                            var second = oDate.getSeconds(); //秒
                                                                            if(month < 10){
                                                                                var month = '0' + month.toString();
                                                                            }
                                                                            if(day < 10){
                                                                                var day = '0' + day.toString();
                                                                            }
                                                                            if(hour < 10){
                                                                                var hour = '0' + hour.toString();
                                                                            }
                                                                            if(minute < 10){
                                                                                var minute = '0' + minute.toString();
                                                                            }
                                                                            if(second < 10){
                                                                                var second = '0' + second.toString();
                                                                            }
                                                                            var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                            console.log(task_time);
                                                                            console.log("systemName="+systemName_selected);
                                                                            console.log("deviceName="+deviceName);
                                                                            console.log("fileName="+fileName);
                                                                            $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'systemName': systemName_selected,'deviceID': deviceID,'deviceName':deviceName, 'deviceType':deviceType,'fileID':fileID,'fileName':fileName,'task_time': task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //若没有未备份的重复文件，则直接写入记录
                                                                                if (data.code == code.RETURNCODE.OK) {
                                                                                    console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件成功！");
                                                                                    //alert("在备份表上写入文件成功！");
                                                                                } else {
                                                                                    console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！")
                                                                                    //alert("在备份表上写入文件失败！");
                                                                                }
                                                                            })
                                                                            month = parseInt(month);
                                                                            day = parseInt(day);
                                                                            hour = parseInt(hour);
                                                                            minute = parseInt(minute);
                                                                            second = parseInt(second);
                                                                        }
                                                                    }
                                                                })
                                                            })//对取出的所有的fileID进行循环操作
                                                        }
                                                    } else {
                                                        alert("在设备下取出file失败！")
                                                    }
                                                })//取一个设备下所有的fileID
                                            })//对取出的所有的deviceID进行循环操作
                                            alert("写入系统备份策略成功!");
                                        }//已经取出所有deviceID
                                    })//取所有deviceID
                                }//已经取出systemID
                            }) //取systemID
                        }else{
                            alert("请输入备份次数！");
                        }
                    }  //给定频率不空，自定义频率为空；
                    if(system_selfdefinition_backup_Frequency){  //给定频率为空，自定义频率不空；
                        if(system_times) {      //备份次数不空
                            $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NOSYSTEMID) {
                                    console.log("此系统不存在systemID!")
                                    return;
                                } else {
                                    var systemID = data.systemID[0].systemID;
                                    //console.log('systemID 1239 = '+ systemID);
                                    $.post(httpHost + '/../get_AlldeviceID', {'systemID': systemID}, function (data) { //通过systemID拿到所有deviceID
                                        //console.log(data.deviceID);
                                        var deviceIDlength = data.deviceID.length;
                                        console.log("deviceIDlength 1242 = " + deviceIDlength);
                                        if (deviceIDlength == 0) {
                                            console.log("此系统无设备以及文件，不用备份！");
                                            alert("此系统下无设备以及文件，无需备份！");
                                        } else {   //系统下有设备的备份情况
                                            var deviceID = data.deviceID;
                                            $.each(deviceID, function (i, deviceID) {   //此处循环不可用for，while，因为它们发生了异步请求之后，会导致所有异步请求成功之后的deviceID都是最后一条数据。
                                                var deviceID = data.deviceID[i].deviceID;
                                                var deviceName = data.deviceID[i].deviceName;
                                                var deviceID = data.deviceID[i].deviceID;
                                                var deviceType = data.deviceID[i].deviceType;
                                                var deviceName = data.deviceID[i].deviceName;
                                                var host = data.deviceID[i].ipAddress;
                                                var host_user = data.deviceID[i].deviceUserName;
                                                var password = data.deviceID[i].devicePassword;
                                                $.post(httpHost + '/../get_AllfileID', {'deviceID': deviceID}, function (data) { //device下拿到所有fileID
                                                    if (data.code == code.RETURNCODE.OK) {
                                                        var fileIDlength = data.fileID.length;
                                                        console.log("i= " + i);
                                                        console.log('deviceID[' + i + '] = ' + deviceID + "," + "fileIDlength = " + fileIDlength);
                                                        if (fileIDlength == 0) {
                                                            console.log("此设备下没有文件，无需备份!");
                                                            /*$.post(httpHost + '/../check_deviceID', {'deviceID': deviceID}, function (data) {  //检查是否有重复的且状态为未备份的设备记录
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             $.post(httpHost + '/../delete_tasks_deviceID', {'deviceID': deviceID}, function (data) {  //若有状态为未备份的重复设备，则删除旧的设备备份策略
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             var oDate = new Date();
                                                             for(var i = 0;i < system_times; i++){
                                                             oDate.setTime(oDate.getTime() + system_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                             var year = oDate.getFullYear();   //获取系统的年；
                                                             var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                             var day = oDate.getDate(); // 获取系统日，
                                                             var hour = oDate.getHours(); //获取系统时，
                                                             var minute = oDate.getMinutes(); //分
                                                             var second = oDate.getSeconds(); //秒
                                                             if(month < 10){
                                                             var month = '0' + month.toString();
                                                             }
                                                             if(day < 10){
                                                             var day = '0' + day.toString();
                                                             }
                                                             if(hour < 10){
                                                             var hour = '0' + hour.toString();
                                                             }
                                                             if(minute < 10){
                                                             var minute = '0' + minute.toString();
                                                             }
                                                             if(second < 10){
                                                             var second = '0' + second.toString();
                                                             }
                                                             var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                             console.log(task_time);
                                                             $.post(httpHost + '/../write_deviceID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'task_time':task_time,'host':host,'host_user':host_user,'password':password}, function (data) {  //删除旧的设备备份策略后，写入新的设备备份策略
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略成功！");
                                                             //alert("在备份表上写入新的设备备份策略成功！");
                                                             } else {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略失败！");
                                                             //alert("在备份表上写入新的设备备份策略失败！");
                                                             }
                                                             })
                                                             month = parseInt(month);
                                                             day = parseInt(day);
                                                             hour = parseInt(hour);
                                                             minute = parseInt(minute);
                                                             second = parseInt(second);
                                                             }
                                                             } else {
                                                             console.log("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                             //alert("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                             }
                                                             })
                                                             } else {   //若表上设备未备份记录不存在，则直接写入
                                                             var oDate = new Date();
                                                             for(var i = 0;i < system_times; i++) {
                                                             oDate.setTime(oDate.getTime() + system_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                             var year = oDate.getFullYear();   //获取系统的年；
                                                             var month = oDate.getMonth() + 1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                             var day = oDate.getDate(); // 获取系统日，
                                                             var hour = oDate.getHours(); //获取系统时，
                                                             var minute = oDate.getMinutes(); //分
                                                             var second = oDate.getSeconds(); //秒
                                                             if (month < 10) {
                                                             var month = '0' + month.toString();
                                                             }
                                                             if (day < 10) {
                                                             var day = '0' + day.toString();
                                                             }
                                                             if (hour < 10) {
                                                             var hour = '0' + hour.toString();
                                                             }
                                                             if (minute < 10) {
                                                             var minute = '0' + minute.toString();
                                                             }
                                                             if (second < 10) {
                                                             var second = '0' + second.toString();
                                                             }
                                                             var task_time = year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
                                                             console.log(task_time);
                                                             $.post(httpHost + '/../write_deviceID', {'userID': userID, 'systemID': systemID, 'deviceID': deviceID, 'deviceType': deviceType, 'task_time':task_time, 'host': host, 'host_user': host_user, 'password': password}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略成功！");
                                                             //alert("在备份表上写入设备备份策略成功！");
                                                             } else {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略失败！");
                                                             //alert("在备份表上写入设备备份策略失败！");
                                                             }
                                                             })
                                                             month = parseInt(month);
                                                             day = parseInt(day);
                                                             hour = parseInt(hour);
                                                             minute = parseInt(minute);
                                                             second = parseInt(second);
                                                             }
                                                             }
                                                             })*/
                                                        } else {   //若设备下有文件
                                                            var fileID = data.fileID;
                                                            $.each(fileID, function (j, fileID) {
                                                                var fileID = data.fileID[j].fileID;
                                                                var fileName = data.fileID[j].fileName;
                                                                var remote_file = data.fileID[j].remote_file;
                                                                var local_path = data.fileID[j].local_path;
                                                                var route_command = data.fileID[j].route_command;
                                                                var route_keywords = data.fileID[j].route_keywords;
                                                                console.log('fileID [' + j + '] = ' + fileID);
                                                                $.post(httpHost + '/../check_fileID', {'fileID': fileID}, function (data) {  //检查是否有重复备份记录
                                                                    if (data.code == code.RETURNCODE.OK) {
                                                                        $.post(httpHost + '/../delete_tasks_fileID', {'fileID': fileID}, function (data) {   //若有未备份的重复文件，则先进行删除文件记录，再写入文件记录
                                                                            if (data.code == code.RETURNCODE.OK) {
                                                                                var oDate = new Date();
                                                                                for(var i = 0;i < system_times; i++){
                                                                                    oDate.setTime(oDate.getTime() + system_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                                                    var year = oDate.getFullYear();   //获取系统的年；
                                                                                    var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                                    var day = oDate.getDate(); // 获取系统日，
                                                                                    var hour = oDate.getHours(); //获取系统时，
                                                                                    var minute = oDate.getMinutes(); //分
                                                                                    var second = oDate.getSeconds(); //秒
                                                                                    if(month < 10){
                                                                                        var month = '0' + month.toString();
                                                                                    }
                                                                                    if(day < 10){
                                                                                        var day = '0' + day.toString();
                                                                                    }
                                                                                    if(hour < 10){
                                                                                        var hour = '0' + hour.toString();
                                                                                    }
                                                                                    if(minute < 10){
                                                                                        var minute = '0' + minute.toString();
                                                                                    }
                                                                                    if(second < 10){
                                                                                        var second = '0' + second.toString();
                                                                                    }
                                                                                    var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                                    console.log(task_time);
                                                                                    console.log("systemName=" + systemName_selected);
                                                                                    console.log("deviceName=" + deviceName);
                                                                                    console.log("fileName=" + fileName);
                                                                                    $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID,'systemName':systemName_selected, 'deviceID': deviceID,'deviceName':deviceName, 'deviceType':deviceType,'fileID':fileID,'fileName':fileName, 'task_time': task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                                                        if (data.code == code.RETURNCODE.OK) {
                                                                                            console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                            //alert("在备份表上写入新的文件备份策略成功！");
                                                                                        } else {
                                                                                            console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                            //alert("在备份表上写入新的文件备份策略成功！");
                                                                                        }
                                                                                    })
                                                                                    month = parseInt(month);
                                                                                    day = parseInt(day);
                                                                                    hour = parseInt(hour);
                                                                                    minute = parseInt(minute);
                                                                                    second = parseInt(second);
                                                                                }
                                                                            } else {
                                                                                console.log("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                                //alert("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                            }
                                                                        })
                                                                    } else {   //若暂无记录
                                                                        var oDate = new Date();
                                                                        for(var i = 0;i < system_times; i++){
                                                                            oDate.setTime(oDate.getTime() + system_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                                            var year = oDate.getFullYear();   //获取系统的年；
                                                                            var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                            var day = oDate.getDate(); // 获取系统日，
                                                                            var hour = oDate.getHours(); //获取系统时，
                                                                            var minute = oDate.getMinutes(); //分
                                                                            var second = oDate.getSeconds(); //秒
                                                                            if(month < 10){
                                                                                var month = '0' + month.toString();
                                                                            }
                                                                            if(day < 10){
                                                                                var day = '0' + day.toString();
                                                                            }
                                                                            if(hour < 10){
                                                                                var hour = '0' + hour.toString();
                                                                            }
                                                                            if(minute < 10){
                                                                                var minute = '0' + minute.toString();
                                                                            }
                                                                            if(second < 10){
                                                                                var second = '0' + second.toString();
                                                                            }
                                                                            var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                            console.log(task_time);
                                                                            console.log("systemName="+systemName_selected);
                                                                            console.log("deviceName="+deviceName);
                                                                            console.log("fileName="+fileName);
                                                                            $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID,'systemName':systemName_selected, 'deviceID': deviceID,'deviceName':deviceName, 'deviceType':deviceType,'fileID':fileID,'fileName':fileName, 'task_time': task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //若没有未备份的重复文件，则直接写入记录
                                                                                if (data.code == code.RETURNCODE.OK) {
                                                                                    console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件成功！");
                                                                                    //alert("在备份表上写入文件成功！");
                                                                                } else {
                                                                                    console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！")
                                                                                    //alert("在备份表上写入文件失败！");
                                                                                }
                                                                            })
                                                                            month = parseInt(month);
                                                                            day = parseInt(day);
                                                                            hour = parseInt(hour);
                                                                            minute = parseInt(minute);
                                                                            second = parseInt(second);
                                                                        }
                                                                    }
                                                                })
                                                            })//对取出的所有的fileID进行循环操作
                                                        }
                                                    } else {
                                                        alert("在设备下取出file失败！")
                                                    }
                                                })//取一个设备下所有的fileID
                                            })//对取出的所有的deviceID进行循环操作
                                            alert("写入系统备份策略成功!");
                                        }//已经取出所有deviceID
                                    })//取所有deviceID
                                }//已经取出systemID
                            }) //取systemID
                        }else{
                            alert("请输入备份次数!");
                        }
                    }  //给定频率为空，自定义频率不空；

                }else{
                    alert("请选择备份频率或者输入自定义备份频率！")
                }
            } else{
                alert("请先选择系统！")
            }
        })

        //若有特殊设备需要不同的备份策略，则可点击“开始设备备份”进行单独的不同的备份策略
        $("#backup_device_confirm").on("click",function(){
            var userID = localStorage['userID'];
            var systemName_selected = $("#systemChoose option:selected").text();
            if (systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("此系统不存在systemID!")
                        return;
                    }else{
                        var systemID = data.systemID[0].systemID;
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        var device_selfdefinition_backup_Frequency = $("#device_selfdefinition_backup_Frequency").val().trim(); //获取设备自定义备份频率
                        var device_backup_Frequency = $("#device_backup_Frequency option:selected").text();  //获取设备下拉框选定的备份频率
                        var device_times = $("#device_backup_times").val().trim(); //获取设备备份次数
                        if(deviceName_selected!='-- 请选择设备 --'){
                            if (device_backup_Frequency != '--请选择设备备份频率--' || device_selfdefinition_backup_Frequency) {

                                if(device_backup_Frequency != '--请选择设备备份频率--'){   //选择给定的备份频率
                                    console.log(device_backup_Frequency);
                                    var device_backup_Frequency_Drop_down = new Array('一周(7D)','一月(30D)','三月(91D)','半年(182D)','一年(365D)');  //将下拉框选定值转化为备份频率数值
                                    var device_backup_Frequency_trans = new Array(7,30,91,182,365);
                                    for(var z = 0;z<device_backup_Frequency_Drop_down.length;z++){
                                        if(device_backup_Frequency == device_backup_Frequency_Drop_down[z]){
                                            var device_backup_Frequency_dis = device_backup_Frequency_trans[z];   //备份频率数值
                                            break;
                                        }
                                    }
                                    if(device_times) {
                                        $.post(httpHost + '/../get_deviceID', {'systemID': systemID,'deviceName_selected':deviceName_selected}, function (data) {
                                            if (data.code === code.RETURNCODE.NODEVICENAME) {
                                                console.log("此系统下没有设备！")
                                                return;
                                            }else{
                                                var deviceID = data.deviceID[0].deviceID;
                                                var deviceType = data.deviceID[0].deviceType;
                                                var host = data.deviceID[0].ipAddress;
                                                var host_user = data.deviceID[0].deviceUserName;
                                                var password = data.deviceID[0].devicePassword;
                                                $.post(httpHost + '/../get_AllfileID', {'deviceID': deviceID}, function (data) { //device下拿到所有file
                                                    if (data.code == code.RETURNCODE.OK) {
                                                        var fileIDlength = data.fileID.length;
                                                        console.log("fileIDlength = " + fileIDlength);
                                                        if (fileIDlength == 0) {
                                                            console.log("此设备下没有文件，无需备份!");
                                                            alert("此设备下没有文件，无需备份!");
                                                            /*$.post(httpHost + '/../check_deviceID', {'deviceID': deviceID}, function (data) {  //检查是否有重复的且状态为未备份的设备记录
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             $.post(httpHost + '/../delete_tasks_deviceID', {'deviceID': deviceID}, function (data) {  //若有状态为未备份的重复设备，则删除旧的设备备份策略
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             var oDate = new Date();
                                                             for(var i = 0;i < device_times; i++){
                                                             oDate.setTime(oDate.getTime() + device_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                             var year = oDate.getFullYear();   //获取系统的年；
                                                             var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                             var day = oDate.getDate(); // 获取系统日，
                                                             var hour = oDate.getHours(); //获取系统时，
                                                             var minute = oDate.getMinutes(); //分
                                                             var second = oDate.getSeconds(); //秒
                                                             if(month < 10){
                                                             var month = '0' + month.toString();
                                                             }
                                                             if(day < 10){
                                                             var day = '0' + day.toString();
                                                             }
                                                             if(hour < 10){
                                                             var hour = '0' + hour.toString();
                                                             }
                                                             if(minute < 10){
                                                             var minute = '0' + minute.toString();
                                                             }
                                                             if(second < 10){
                                                             var second = '0' + second.toString();
                                                             }
                                                             var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                             console.log(task_time);
                                                             $.post(httpHost + '/../write_deviceID', {'userID': userID, 'systemID': systemID, 'deviceID': deviceID, 'deviceType': deviceType, 'task_time':task_time, 'host': host, 'host_user': host_user, 'password': password}, function (data) {  //删除旧的设备备份策略后，写入新的设备备份策略
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略成功！");
                                                             //alert("在备份表上写入新的设备备份策略成功！");
                                                             } else {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略失败！");
                                                             //alert("在备份表上写入新的设备备份策略失败！");
                                                             }
                                                             })
                                                             month = parseInt(month);
                                                             day = parseInt(day);
                                                             hour = parseInt(hour);
                                                             minute = parseInt(minute);
                                                             second = parseInt(second);
                                                             }
                                                             } else {
                                                             console.log("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                             alert("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                             }
                                                             })
                                                             } else {   //若表上设备未备份记录不存在，则直接写入
                                                             var oDate = new Date();
                                                             for(var i = 0;i < device_times; i++){
                                                             oDate.setTime(oDate.getTime() + device_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                             var year = oDate.getFullYear();   //获取系统的年；
                                                             var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                             var day = oDate.getDate(); // 获取系统日，
                                                             var hour = oDate.getHours(); //获取系统时，
                                                             var minute = oDate.getMinutes(); //分
                                                             var second = oDate.getSeconds(); //秒
                                                             if(month < 10){
                                                             var month = '0' + month.toString();
                                                             }
                                                             if(day < 10){
                                                             var day = '0' + day.toString();
                                                             }
                                                             if(hour < 10){
                                                             var hour = '0' + hour.toString();
                                                             }
                                                             if(minute < 10){
                                                             var minute = '0' + minute.toString();
                                                             }
                                                             if(second < 10){
                                                             var second = '0' + second.toString();
                                                             }
                                                             var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                             console.log(task_time);
                                                             $.post(httpHost + '/../write_deviceID', {'userID': userID, 'systemID': systemID, 'deviceID': deviceID, 'deviceType': deviceType, 'task_time':task_time, 'host': host, 'host_user': host_user, 'password': password}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                             if (data.code == code.RETURNCODE.OK) {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略成功！");
                                                             //alert("在备份表上写入设备备份策略成功！");
                                                             } else {
                                                             console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略失败！");
                                                             //alert("在备份表上写入设备备份策略失败！");
                                                             }
                                                             })
                                                             month = parseInt(month);
                                                             day = parseInt(day);
                                                             hour = parseInt(hour);
                                                             minute = parseInt(minute);
                                                             second = parseInt(second);
                                                             }
                                                             }
                                                             })*/
                                                        } else {   //若设备下有文件
                                                            var fileID = data.fileID;
                                                            $.each(fileID,function(j,fileID) {
                                                                var fileID = data.fileID[j].fileID;
                                                                var remote_file = data.fileID[j].remote_file;
                                                                var local_path = data.fileID[j].local_path;
                                                                var route_command = data.fileID[j].route_command;
                                                                var route_keywords = data.fileID[j].route_keywords;
                                                                console.log('fileID [' + j + '] = ' + fileID);
                                                                $.post(httpHost + '/../check_fileID', {'fileID': fileID}, function (data) {  //检查该文件是否在tasks表中存在
                                                                    if (data.code == code.RETURNCODE.OK) {
                                                                        $.post(httpHost + '/../delete_tasks_fileID', {'fileID': fileID}, function (data) {   //若tasks表中存在，则先进行删除文件记录，再写入文件记录
                                                                            if (data.code == code.RETURNCODE.OK) {
                                                                                var oDate = new Date();
                                                                                for(var i = 0;i < device_times; i++){
                                                                                    oDate.setTime(oDate.getTime() + device_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                                                    var year = oDate.getFullYear();   //获取系统的年；
                                                                                    var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                                    var day = oDate.getDate(); // 获取系统日，
                                                                                    var hour = oDate.getHours(); //获取系统时，
                                                                                    var minute = oDate.getMinutes(); //分
                                                                                    var second = oDate.getSeconds(); //秒
                                                                                    if(month < 10){
                                                                                        var month = '0' + month.toString();
                                                                                    }
                                                                                    if(day < 10){
                                                                                        var day = '0' + day.toString();
                                                                                    }
                                                                                    if(hour < 10){
                                                                                        var hour = '0' + hour.toString();
                                                                                    }
                                                                                    if(minute < 10){
                                                                                        var minute = '0' + minute.toString();
                                                                                    }
                                                                                    if(second < 10){
                                                                                        var second = '0' + second.toString();
                                                                                    }
                                                                                    var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                                    console.log(task_time);
                                                                                    $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                                                        if (data.code == code.RETURNCODE.OK) {
                                                                                            console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                        } else {
                                                                                            console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                        }
                                                                                    })
                                                                                    month = parseInt(month);
                                                                                    day = parseInt(day);
                                                                                    hour = parseInt(hour);
                                                                                    minute = parseInt(minute);
                                                                                    second = parseInt(second);
                                                                                }
                                                                            }else {
                                                                                console.log("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                            }
                                                                        })
                                                                    } else {  //若tasks表中无该文件记录，直接写入文件记录
                                                                        var oDate = new Date();
                                                                        for(var i = 0;i < device_times; i++){
                                                                            oDate.setTime(oDate.getTime() + device_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                                            var year = oDate.getFullYear();   //获取系统的年；
                                                                            var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                            var day = oDate.getDate(); // 获取系统日，
                                                                            var hour = oDate.getHours(); //获取系统时，
                                                                            var minute = oDate.getMinutes(); //分
                                                                            var second = oDate.getSeconds(); //秒
                                                                            if(month < 10){
                                                                                var month = '0' + month.toString();
                                                                            }
                                                                            if(day < 10){
                                                                                var day = '0' + day.toString();
                                                                            }
                                                                            if(hour < 10){
                                                                                var hour = '0' + hour.toString();
                                                                            }
                                                                            if(minute < 10){
                                                                                var minute = '0' + minute.toString();
                                                                            }
                                                                            if(second < 10){
                                                                                var second = '0' + second.toString();
                                                                            }
                                                                            var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                            console.log(task_time);
                                                                            $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //若没有未备份的重复文件，则直接写入记录
                                                                                if (data.code == code.RETURNCODE.OK) {
                                                                                    console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件成功！");
                                                                                    //alert("在备份表上写入文件成功！");
                                                                                } else {
                                                                                    console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！");
                                                                                    //alert("在备份表上写入文件失败！");
                                                                                }
                                                                            })
                                                                            month = parseInt(month);
                                                                            day = parseInt(day);
                                                                            hour = parseInt(hour);
                                                                            minute = parseInt(minute);
                                                                            second = parseInt(second);
                                                                        }
                                                                    }
                                                                })
                                                            })//对取出的所有的fileID进行循环操作
                                                            alert("写入文件备份策略成功1！")
                                                        }
                                                    } else {
                                                        alert("在设备下取出file失败！备份失败，请重试！");
                                                    }
                                                })
                                            }
                                        })
                                    }else{
                                        alert("请输入设备备份次数！")
                                    }
                                }

                                if(device_selfdefinition_backup_Frequency){   //自定义设备备份间隔时间
                                    $.post(httpHost + '/../get_deviceID', {'systemID': systemID,'deviceName_selected':deviceName_selected}, function (data) {
                                        if (data.code === code.RETURNCODE.NODEVICENAME) {
                                            console.log("no device in this system!")
                                            return;
                                        }else{
                                            var deviceID = data.deviceID[0].deviceID;
                                            var host = data.deviceID[0].ipAddress;
                                            var host_user = data.deviceID[0].deviceUserName;
                                            var password = data.deviceID[0].devicePassword;
                                            var deviceType = data.deviceID[0].deviceType;
                                            $.post(httpHost + '/../get_AllfileID', {'deviceID': deviceID}, function (data) { //device下拿到所有fileID
                                                if (data.code == code.RETURNCODE.OK) {
                                                    var fileIDlength = data.fileID.length;
                                                    console.log("fileIDlength = " + fileIDlength);
                                                    if (fileIDlength == 0) {
                                                        console.log("此设备下没有文件，无需备份!");
                                                        alert("此设备下没有文件，无需备份!");
                                                        /*$.post(httpHost + '/../check_deviceID', {'deviceID': deviceID}, function (data) {  //检查是否有重复的且状态为未备份的设备记录
                                                         if (data.code == code.RETURNCODE.OK) {
                                                         $.post(httpHost + '/../delete_backupInfo_deviceID', {'deviceID': deviceID}, function (data) {  //若有状态为未备份的重复设备，则删除旧的设备备份策略
                                                         if (data.code == code.RETURNCODE.OK) {
                                                         var oDate = new Date();
                                                         for(var i = 0;i < device_times; i++){
                                                         oDate.setTime(oDate.getTime() + device_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                         var year = oDate.getFullYear();   //获取系统的年；
                                                         var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                         var day = oDate.getDate(); // 获取系统日，
                                                         var hour = oDate.getHours(); //获取系统时，
                                                         var minute = oDate.getMinutes(); //分
                                                         var second = oDate.getSeconds(); //秒
                                                         if(month < 10){
                                                         var month = '0' + month.toString();
                                                         }
                                                         if(day < 10){
                                                         var day = '0' + day.toString();
                                                         }
                                                         if(hour < 10){
                                                         var hour = '0' + hour.toString();
                                                         }
                                                         if(minute < 10){
                                                         var minute = '0' + minute.toString();
                                                         }
                                                         if(second < 10){
                                                         var second = '0' + second.toString();
                                                         }
                                                         var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                         console.log(task_time);
                                                         $.post(httpHost + '/../write_deviceID', {'userID': userID, 'systemID': systemID, 'deviceID': deviceID, 'deviceType': deviceType, 'task_time':task_time, 'host': host, 'host_user': host_user, 'password': password}, function (data) {  //删除旧的设备备份策略后，写入新的设备备份策略
                                                         if (data.code == code.RETURNCODE.OK) {
                                                         console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略成功！");
                                                         //alert("在备份表上写入新的设备备份策略成功！");
                                                         } else {
                                                         console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入新的设备备份策略失败！");
                                                         //alert("在备份表上写入新的设备备份策略失败！");
                                                         }
                                                         })
                                                         month = parseInt(month);
                                                         day = parseInt(day);
                                                         hour = parseInt(hour);
                                                         minute = parseInt(minute);
                                                         second = parseInt(second);
                                                         }
                                                         } else {
                                                         console.log("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                         alert("系统中有此未备份设备的旧的备份策略，此次替换成新的设备备份策略失败！请重新操作！");
                                                         }
                                                         })
                                                         } else {   //若表上设备未备份记录不存在，则直接写入
                                                         var oDate = new Date();
                                                         for(var i = 0;i < device_times; i++){
                                                         oDate.setTime(oDate.getTime() + device_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                         var year = oDate.getFullYear();   //获取系统的年；
                                                         var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                         var day = oDate.getDate(); // 获取系统日，
                                                         var hour = oDate.getHours(); //获取系统时，
                                                         var minute = oDate.getMinutes(); //分
                                                         var second = oDate.getSeconds(); //秒
                                                         if(month < 10){
                                                         var month = '0' + month.toString();
                                                         }
                                                         if(day < 10){
                                                         var day = '0' + day.toString();
                                                         }
                                                         if(hour < 10){
                                                         var hour = '0' + hour.toString();
                                                         }
                                                         if(minute < 10){
                                                         var minute = '0' + minute.toString();
                                                         }
                                                         if(second < 10){
                                                         var second = '0' + second.toString();
                                                         }
                                                         var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                         console.log(task_time);
                                                         $.post(httpHost + '/../write_deviceID', {'userID': userID, 'systemID': systemID, 'deviceID': deviceID, 'deviceType': deviceType, 'task_time':task_time, 'host': host, 'host_user': host_user, 'password': password}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                         if (data.code == code.RETURNCODE.OK) {
                                                         console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略成功！");
                                                         //alert("在备份表上写入设备备份策略成功！");
                                                         } else {
                                                         console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "在备份表上写入设备备份策略失败！");
                                                         //alert("在备份表上写入设备备份策略失败！");
                                                         }
                                                         })
                                                         month = parseInt(month);
                                                         day = parseInt(day);
                                                         hour = parseInt(hour);
                                                         minute = parseInt(minute);
                                                         second = parseInt(second);
                                                         }
                                                         }
                                                         })*/
                                                    } else {   //若设备下有文件
                                                        var fileID = data.fileID;
                                                        $.each(fileID,function(j,fileID) {
                                                            var fileID = data.fileID[j].fileID;
                                                            var remote_file = data.fileID[j].remote_file;
                                                            var local_path = data.fileID[j].local_path;
                                                            var route_command = data.fileID[j].route_command;
                                                            var route_keywords = data.fileID[j].route_keywords;
                                                            console.log('fileID [' + j + '] = ' + fileID);
                                                            $.post(httpHost + '/../check_fileID', {'fileID': fileID}, function (data) {  //检查是否有重复备份记录
                                                                if (data.code == code.RETURNCODE.OK) {
                                                                    $.post(httpHost + '/../delete_tasks_fileID', {'fileID': fileID}, function (data) {   //若有未备份的重复文件，则先进行删除文件记录，再写入文件记录
                                                                        if (data.code == code.RETURNCODE.OK) {
                                                                            var oDate = new Date();
                                                                            for(var i = 0;i < device_times; i++){
                                                                                oDate.setTime(oDate.getTime() + device_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                                                var year = oDate.getFullYear();   //获取系统的年；
                                                                                var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                                var day = oDate.getDate(); // 获取系统日，
                                                                                var hour = oDate.getHours(); //获取系统时，
                                                                                var minute = oDate.getMinutes(); //分
                                                                                var second = oDate.getSeconds(); //秒
                                                                                if(month < 10){
                                                                                    var month = '0' + month.toString();
                                                                                }
                                                                                if(day < 10){
                                                                                    var day = '0' + day.toString();
                                                                                }
                                                                                if(hour < 10){
                                                                                    var hour = '0' + hour.toString();
                                                                                }
                                                                                if(minute < 10){
                                                                                    var minute = '0' + minute.toString();
                                                                                }
                                                                                if(second < 10){
                                                                                    var second = '0' + second.toString();
                                                                                }
                                                                                var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                                console.log(task_time);
                                                                                var success = 0;
                                                                                var unsuccess = 0;
                                                                                $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                                                    if (data.code == code.RETURNCODE.OK) {
                                                                                        success = success + 1;
                                                                                        console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                    } else {
                                                                                        console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                        unsuccess = unsuccess + 1;
                                                                                    }
                                                                                })
                                                                                month = parseInt(month);
                                                                                day = parseInt(day);
                                                                                hour = parseInt(hour);
                                                                                minute = parseInt(minute);
                                                                                second = parseInt(second);
                                                                            }
                                                                        }else {
                                                                            console.log("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                        }
                                                                    })
                                                                } else {   //若无重复记录
                                                                    var oDate = new Date();
                                                                    for(var i = 0;i < device_times; i++){
                                                                        oDate.setTime(oDate.getTime() + device_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                                        var year = oDate.getFullYear();   //获取系统的年；
                                                                        var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                        var day = oDate.getDate(); // 获取系统日，
                                                                        var hour = oDate.getHours(); //获取系统时，
                                                                        var minute = oDate.getMinutes(); //分
                                                                        var second = oDate.getSeconds(); //秒
                                                                        if(month < 10){
                                                                            var month = '0' + month.toString();
                                                                        }
                                                                        if(day < 10){
                                                                            var day = '0' + day.toString();
                                                                        }
                                                                        if(hour < 10){
                                                                            var hour = '0' + hour.toString();
                                                                        }
                                                                        if(minute < 10){
                                                                            var minute = '0' + minute.toString();
                                                                        }
                                                                        if(second < 10){
                                                                            var second = '0' + second.toString();
                                                                        }
                                                                        var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                        console.log(task_time);
                                                                        var success = 0;
                                                                        var unsuccess = 0;
                                                                        $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //若没有未备份的重复文件，则直接写入记录
                                                                            if (data.code == code.RETURNCODE.OK) {
                                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件成功！");
                                                                                success +=1;
                                                                                //alert("在备份表上写入文件成功！");
                                                                            } else {
                                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！");
                                                                                unsuccess +=1;
                                                                                //alert("在备份表上写入文件失败！");
                                                                            }
                                                                        })
                                                                        month = parseInt(month);
                                                                        day = parseInt(day);
                                                                        hour = parseInt(hour);
                                                                        minute = parseInt(minute);
                                                                        second = parseInt(second);
                                                                    }
                                                                }
                                                            })
                                                        })//对取出的所有的fileID进行循环操作
                                                        alert("写入文件备份策略成功2！")
                                                    }
                                                } else {
                                                    alert("在设备下取出file失败！请重试！");
                                                }
                                            })

                                        }
                                    })
                                }

                            }else{
                                alert("请选择设备备份频率或者输入自定义设备备份频率！");
                            }
                        }else{
                            alert("请先选择设备！");
                        }
                    }//已经取出systemID
                }) //取systemID
            }else{
                alert("请先选择系统！");
            }
        })

        //若有特殊文件需要不同的备份策略，则可点击“开始文件备份”进行单独的不同的备份策略
        $("#backup_file_confirm").on("click",function() {
            var userID = localStorage['userID'];
            var systemName_selected = $("#systemChoose option:selected").text();
            if (systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("此系统不存在systemID!")
                        return;
                    } else {
                        var systemID = data.systemID[0].systemID;
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        if (deviceName_selected != '-- 请选择设备 --') {
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID, 'deviceName_selected': deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICENAME) {
                                    console.log("no device in this system!")
                                    return;
                                } else {
                                    var deviceID = data.deviceID[0].deviceID;
                                    var deviceType = data.deviceID[0].deviceType;
                                    var host = data.deviceID[0].ipAddress;
                                    var host_user = data.deviceID[0].deviceUserName;
                                    var password = data.deviceID[0].devicePassword;
                                    var fileName_selected = $("#fileChoose option:selected").text();
                                    var file_times = $("#file_backup_times").val().trim(); //获取文件备份次数
                                    if (fileName_selected != '-- 请选择文件 --') {
                                        var file_selfdefinition_backup_Frequency = $("#file_selfdefinition_backup_Frequency").val().trim(); //获取设备自定义备份频率
                                        var file_backup_Frequency = $("#file_backup_Frequency option:selected").text();  //获取设备下拉框选定的备份频率
                                        if (file_backup_Frequency != '--请选择文件备份频率--' || file_selfdefinition_backup_Frequency) {

                                            if(file_backup_Frequency != '--请选择文件备份频率--'){
                                                var file_backup_Frequency_Drop_down = new Array('一周(7D)','一月(30D)','三月(91D)','半年(182D)','一年(365D)');  //将下拉框选定值转化为备份频率数值
                                                var file_backup_Frequency_trans = new Array(7,30,91,182,365);
                                                for(var z = 0;z<file_backup_Frequency_Drop_down.length;z++){
                                                    if(file_backup_Frequency == file_backup_Frequency_Drop_down[z]){
                                                        var file_backup_Frequency_dis = file_backup_Frequency_trans[z];   //备份频率数值
                                                        break;
                                                    }
                                                }
                                                if(file_times) {
                                                    $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                                        if (data.code === code.RETURNCODE.NOFILENAME) {
                                                            console.log("no file in this device!")
                                                            return;
                                                        } else {
                                                            var fileID = data.fileID[0].fileID;
                                                            var remote_file = data.fileID[0].remote_file;
                                                            var local_path = data.fileID[0].local_path;
                                                            var route_command = data.fileID[0].route_command;
                                                            var route_keywords = data.fileID[0].route_keywords;
                                                            $.post(httpHost + '/../check_fileID', {'fileID': fileID}, function (data) {  //检查是否有重复备份记录
                                                                if (data.code == code.RETURNCODE.OK) {
                                                                    $.post(httpHost + '/../delete_tasks_fileID', {'fileID': fileID}, function (data) {   //若有未备份的重复文件，则先进行删除文件记录，再写入文件记录
                                                                        if (data.code == code.RETURNCODE.OK) {
                                                                            var oDate = new Date();
                                                                            for(var i = 0;i < file_times; i++){
                                                                                oDate.setTime(oDate.getTime() + file_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                                                var year = oDate.getFullYear();   //获取系统的年；
                                                                                var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                                var day = oDate.getDate(); // 获取系统日，
                                                                                var hour = oDate.getHours(); //获取系统时，
                                                                                var minute = oDate.getMinutes(); //分
                                                                                var second = oDate.getSeconds(); //秒
                                                                                if(month < 10){
                                                                                    var month = '0' + month.toString();
                                                                                }
                                                                                if(day < 10){
                                                                                    var day = '0' + day.toString();
                                                                                }
                                                                                if(hour < 10){
                                                                                    var hour = '0' + hour.toString();
                                                                                }
                                                                                if(minute < 10){
                                                                                    var minute = '0' + minute.toString();
                                                                                }
                                                                                if(second < 10){
                                                                                    var second = '0' + second.toString();
                                                                                }
                                                                                var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                                console.log(task_time);
                                                                                $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                                                    if (data.code == code.RETURNCODE.OK) {
                                                                                        console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                        //alert("在备份表上写入新的文件备份策略成功！");
                                                                                    } else {
                                                                                        console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略失败！");
                                                                                        alert("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略失败！");
                                                                                    }
                                                                                })
                                                                                month = parseInt(month);
                                                                                day = parseInt(day);
                                                                                hour = parseInt(hour);
                                                                                minute = parseInt(minute);
                                                                                second = parseInt(second);
                                                                            }
                                                                        } else {
                                                                            console.log("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                            //alert("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                        }
                                                                    })
                                                                } else {
                                                                    var oDate = new Date();
                                                                    for(var i = 0;i < file_times; i++){
                                                                        oDate.setTime(oDate.getTime() + device_backup_Frequency_dis * 24 * 60 * 60 * 1000);
                                                                        var year = oDate.getFullYear();   //获取系统的年；
                                                                        var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                        var day = oDate.getDate(); // 获取系统日，
                                                                        var hour = oDate.getHours(); //获取系统时，
                                                                        var minute = oDate.getMinutes(); //分
                                                                        var second = oDate.getSeconds(); //秒
                                                                        if(month < 10){
                                                                            var month = '0' + month.toString();
                                                                        }
                                                                        if(day < 10){
                                                                            var day = '0' + day.toString();
                                                                        }
                                                                        if(hour < 10){
                                                                            var hour = '0' + hour.toString();
                                                                        }
                                                                        if(minute < 10){
                                                                            var minute = '0' + minute.toString();
                                                                        }
                                                                        if(second < 10){
                                                                            var second = '0' + second.toString();
                                                                        }
                                                                        var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                        console.log(task_time);
                                                                        $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //若没有未备份的重复文件，则直接写入记录
                                                                            if (data.code == code.RETURNCODE.OK) {
                                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件成功！");
                                                                                //alert("在备份表上写入文件成功！");
                                                                            } else {
                                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！");
                                                                                alert("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！");
                                                                            }
                                                                        })
                                                                        month = parseInt(month);
                                                                        day = parseInt(day);
                                                                        hour = parseInt(hour);
                                                                        minute = parseInt(minute);
                                                                        second = parseInt(second);
                                                                    }
                                                                }
                                                            })
                                                        }
                                                    }) //取systemID
                                                }alert("写入文件备份策略完成！")

                                            }
                                            if(file_selfdefinition_backup_Frequency){   //自定义文件备份频率
                                                if(file_times){
                                                    $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                                        if (data.code === code.RETURNCODE.NOFILENAME) {
                                                            console.log("no file in this device!")
                                                            return;
                                                        } else {
                                                            var fileID = data.fileID[0].fileID;
                                                            var remote_file = data.fileID[0].remote_file;
                                                            var local_path = data.fileID[0].local_path;
                                                            var route_command = data.fileID[0].route_command;
                                                            var route_keywords = data.fileID[0].route_keywords;
                                                            $.post(httpHost + '/../check_fileID', {'fileID': fileID}, function (data) {  //检查是否有重复备份记录
                                                                if (data.code == code.RETURNCODE.OK) {
                                                                    $.post(httpHost + '/../delete_tasks_fileID', {'fileID': fileID}, function (data) {   //若有未备份的重复文件，则先进行删除文件记录，再写入文件记录
                                                                        if (data.code == code.RETURNCODE.OK) {
                                                                            var oDate = new Date();
                                                                            for(var i = 0;i < file_times; i++){
                                                                                oDate.setTime(oDate.getTime() + file_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                                                var year = oDate.getFullYear();   //获取系统的年；
                                                                                var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                                var day = oDate.getDate(); // 获取系统日，
                                                                                var hour = oDate.getHours(); //获取系统时，
                                                                                var minute = oDate.getMinutes(); //分
                                                                                var second = oDate.getSeconds(); //秒
                                                                                if(month < 10){
                                                                                    var month = '0' + month.toString();
                                                                                }
                                                                                if(day < 10){
                                                                                    var day = '0' + day.toString();
                                                                                }
                                                                                if(hour < 10){
                                                                                    var hour = '0' + hour.toString();
                                                                                }
                                                                                if(minute < 10){
                                                                                    var minute = '0' + minute.toString();
                                                                                }
                                                                                if(second < 10){
                                                                                    var second = '0' + second.toString();
                                                                                }
                                                                                var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                                console.log(task_time);
                                                                                $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //将得到的file数据库备份信息（backup-info）表
                                                                                    if (data.code == code.RETURNCODE.OK) {
                                                                                        console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略成功！");
                                                                                        //alert("文件备份策略已写入！")
                                                                                    } else {
                                                                                        console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略失败！");
                                                                                        alert("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入新的文件备份策略失败！")
                                                                                    }
                                                                                })
                                                                                month = parseInt(month);
                                                                                day = parseInt(day);
                                                                                hour = parseInt(hour);
                                                                                minute = parseInt(minute);
                                                                                second = parseInt(second);
                                                                            }
                                                                        } else {
                                                                            console.log("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                            //alert("系统中有此未备份文件的旧的备份策略，此次替换成新的文件备份策略失败！请重新操作！");
                                                                        }
                                                                    })
                                                                } else {
                                                                    var oDate = new Date();
                                                                    for(var i = 0;i < file_times; i++){
                                                                        oDate.setTime(oDate.getTime() + file_selfdefinition_backup_Frequency * 24 * 60 * 60 * 1000);
                                                                        var year = oDate.getFullYear();   //获取系统的年；
                                                                        var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
                                                                        var day = oDate.getDate(); // 获取系统日，
                                                                        var hour = oDate.getHours(); //获取系统时，
                                                                        var minute = oDate.getMinutes(); //分
                                                                        var second = oDate.getSeconds(); //秒
                                                                        if(month < 10){
                                                                            var month = '0' + month.toString();
                                                                        }
                                                                        if(day < 10){
                                                                            var day = '0' + day.toString();
                                                                        }
                                                                        if(hour < 10){
                                                                            var hour = '0' + hour.toString();
                                                                        }
                                                                        if(minute < 10){
                                                                            var minute = '0' + minute.toString();
                                                                        }
                                                                        if(second < 10){
                                                                            var second = '0' + second.toString();
                                                                        }
                                                                        var task_time = year + '-' + month + '-' + day +  ' ' + hour + ':' + minute + ':' + second;
                                                                        console.log(task_time);
                                                                        $.post(httpHost + '/../write_fileID', {'userID':userID, 'systemID': systemID, 'deviceID': deviceID,'deviceType':deviceType,'fileID':fileID,'task_time':task_time,'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {  //若没有未备份的重复文件，则直接写入记录
                                                                            if (data.code == code.RETURNCODE.OK) {
                                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件成功！");
                                                                                //alert("文件备份策略已写入！")
                                                                            } else {
                                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！");
                                                                                alert("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在备份表上写入文件失败！")
                                                                            }
                                                                        })
                                                                        month = parseInt(month);
                                                                        day = parseInt(day);
                                                                        hour = parseInt(hour);
                                                                        minute = parseInt(minute);
                                                                        second = parseInt(second);
                                                                    }
                                                                }
                                                            })
                                                        }
                                                    }) //取systemID
                                                }alert("写入文件备份策略完成！")
                                            }
                                        }else{
                                            alert("请选择文件备份频率或者输入自定义文件备份频率！");
                                        }

                                    } else {
                                        alert("请先选择文件！");
                                    }
                                }
                            })
                        }else{
                            alert("请先选择设备！");
                        }
                    }
                })
            }else{
                alert("请先选择系统！");
            }
        })

        //测试按钮
        $("#test").on("click",function() {
            var userID = localStorage['userID'];
            var userName = localStorage['userName'];
            var systemName_selected = $("#systemChoose option:selected").text();
            if (systemName_selected != '-- 请选择系统 --') {
                $.post(httpHost + '/../get_systemID', {'userID': userID, 'systemName_selected': systemName_selected}, function (data) {
                    if (data.code === code.RETURNCODE.NOSYSTEMID) {
                        console.log("此系统不存在systemID!")
                        return;
                    } else {
                        var systemID = data.systemID[0].systemID;
                        var deviceName_selected = $("#deviceChoose option:selected").text();
                        if (deviceName_selected != '-- 请选择设备 --') {
                            $.post(httpHost + '/../get_deviceID', {'systemID': systemID, 'deviceName_selected': deviceName_selected}, function (data) {
                                if (data.code === code.RETURNCODE.NODEVICENAME) {
                                    console.log("no device in this system!")
                                    return;
                                } else {
                                    var deviceID = data.deviceID[0].deviceID;
                                    var deviceType = data.deviceID[0].deviceType;
                                    var host = data.deviceID[0].ipAddress;
                                    var host_user = data.deviceID[0].deviceUserName;
                                    var password = data.deviceID[0].devicePassword;
                                    var fileName_selected = $("#fileChoose option:selected").text();
                                    if (fileName_selected != '-- 请选择文件 --') {
                                        $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                            if (data.code === code.RETURNCODE.NOFILENAME) {
                                                console.log("no file in this device!")
                                                return;
                                            } else {
                                                var fileID = data.fileID[0].fileID;
                                                var remote_file  = data.fileID[0].remote_file ;
                                                var local_path  = data.fileID[0].local_path ;
                                                var route_command = data.fileID[0].route_command ;
                                                var route_keywords = data.fileID[0].route_keywords ;
                                                console.log("route_command="+route_command);
                                                console.log("route_keywords="+route_keywords);
                                                //var localPath = "F:/U-BACKUP/" + userName + "/" + systemName_selected + "/" + deviceName_selected;
                                                console.log('local_path = ' + local_path);
                                                $.post(httpHost + '/../check_tasks_test_userID', {'userID': userID}, function (data) {  //检查用户在tasks_test表里是否存在，确保一个用户一条记录
                                                    if (data.code == code.RETURNCODE.OK) {  //若已有用户存在，则更改除用户外的其他字段
                                                        $.post(httpHost + '/../update_tasks_test_user_record', { 'userID':userID,'systemID': systemID,'systemName':systemName_selected, 'deviceID': deviceID,'deviceName':deviceName_selected, 'deviceType':deviceType,'fileID':fileID,'fileName':fileName_selected, 'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {
                                                            if (data.code == code.RETURNCODE.OK) {
                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在测试备份表上写入新的文件备份策略成功！");
                                                                //alert("请前往监控页面查看此条文件备份执行结果！");

                                                                $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                                                    if (data.code === code.RETURNCODE.NOFILENAME) {
                                                                        console.log("no file in this device!")
                                                                        return;
                                                                    } else {
                                                                        //将文件属性值传到页面显示
                                                                        var fileID = data.fileID[0].fileID;
                                                                        console.log(fileID);
                                                                        //$('#getTasks').bootstrapTable('removeAll');
                                                                        $.post(httpHost + '/../test_backupInfo', {'userID': userID}, function (data) {
                                                                            var state = data.state;
                                                                            $.each(state,function(i,state){
                                                                                if(data.state[i].state == 0){
                                                                                    data.state[i].state = '未备份';
                                                                                }
                                                                                if(data.state[i].state == 1){
                                                                                    data.state[i].state = '等待第一次重新备份';
                                                                                }
                                                                                if(data.state[i].state == 2){
                                                                                    data.state[i].state = '等待第二次重新备份';
                                                                                }
                                                                                if(data.state[i].state == 3){
                                                                                    data.state[i].state = '等待第三次重新备份';
                                                                                }
                                                                                if(data.state[i].state == 4){
                                                                                    data.state[i].state = '备份失败';
                                                                                }
                                                                                if(data.state[i].state == 9){
                                                                                    data.state[i].state = '备份成功';
                                                                                }
                                                                            })

                                                                            $("#getTest").bootstrapTable('destroy').bootstrapTable({
                                                                                data: data.state,
                                                                                //pageSize: 10,
                                                                            });
                                                                        })
                                                                    }
                                                                })

                                                            } else {
                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在测试备份表上写入新的文件备份策略失败！");
                                                                //alert("在测试备份表上写入新的文件备份策略失败！");
                                                            }
                                                        })
                                                    }else{
                                                        $.post(httpHost + '/../write_tasks_test_userID', { 'userID':userID,'systemID': systemID,'systemName':systemName_selected, 'deviceID': deviceID,'deviceName':deviceName_selected, 'deviceType':deviceType,'fileID':fileID,'fileName':fileName_selected, 'host':host,'host_user':host_user,'password':password,'remote_file':remote_file,'local_path':local_path,'route_command':route_command,'route_keywords':route_keywords}, function (data) {
                                                            if (data.code == code.RETURNCODE.OK) {
                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在测试备份表上写入新的文件备份策略成功！");
                                                                //alert("请前往监控页面查看此条文件备份执行结果！");

                                                                $.post(httpHost + '/../get_fileID', {'deviceID': deviceID, 'fileName_selected': fileName_selected}, function (data) {
                                                                    if (data.code === code.RETURNCODE.NOFILENAME) {
                                                                        console.log("no file in this device!")
                                                                        return;
                                                                    } else {
                                                                        //将文件属性值传到页面显示
                                                                        var fileID = data.fileID[0].fileID;
                                                                        console.log(fileID);
                                                                        //$('#getTasks').bootstrapTable('removeAll');
                                                                        $.post(httpHost + '/../test_backupInfo', {'userID': userID}, function (data) {
                                                                            /*var datalength = data.state.length;
                                                                             console.log(datalength)
                                                                             console.log(data);*/

                                                                            var state = data.state;
                                                                            $.each(state,function(i,state){
                                                                                if(data.state[i].state == 0){
                                                                                    data.state[i].state = '未备份';
                                                                                }
                                                                                if(data.state[i].state == 1){
                                                                                    data.state[i].state = '等待第一次重新备份';
                                                                                }
                                                                                if(data.state[i].state == 2){
                                                                                    data.state[i].state = '等待第二次重新备份';
                                                                                }
                                                                                if(data.state[i].state == 3){
                                                                                    data.state[i].state = '等待第三次重新备份';
                                                                                }
                                                                                if(data.state[i].state == 4){
                                                                                    data.state[i].state = '备份失败';
                                                                                }
                                                                                if(data.state[i].state == 9){
                                                                                    data.state[i].state = '备份成功';
                                                                                }
                                                                            })

                                                                            $("#getTest").bootstrapTable('destroy').bootstrapTable({
                                                                                data: data.state,
                                                                                //pageSize: 10,
                                                                            });
                                                                        })
                                                                    }
                                                                })
                                                            } else {
                                                                console.log("systemID = " + systemID + ";" + "deviceID = " + deviceID + ";" + "fileID = " + fileID + ";" + "在测试备份表上写入新的文件备份策略失败！");
                                                                //alert("在测试备份表上写入新的文件备份策略失败！");
                                                            }
                                                        })
                                                    }
                                                })
                                            }
                                        }) //取systemID
                                    } else {
                                        alert("请先选择文件！");
                                    }
                                }
                            })
                        }else{
                            alert("请先选择设备！");
                        }
                    }
                })
            }else{
                alert("请先选择系统！");
            }
        })

        /*************************************************************清除数据*********************************************************************/

            //点击清除系统界面输入数据
        $("#deleteSystemData").on("click",function(){
            $("#add_systemName").val("");
            $("#add_systemDescribe").val("");
        })

        //点击清除设备界面输入数据
        $("#deleteDeviceData").on("click",function(){
            $("#add_deviceName").val("");
            $("#add_deviceDescribe").val("");
            $("#add_deviceipAddress").val("");
            $("#add_deviceUserName").val("");
            $("#add_devicePassword").val("");
        })

        //点击清除文件界面输入数据
        $("#deleteFileData").on("click",function(){
            $("#add_fileName").val("");
            $("#add_fileDescribe").val("");
            $("#add_fileabsoluteAddress").val("");
            $("#add_routeCommand").val("");
            $("#add_routeKeyword").val("");
        })

    }

</script>


<!--<script src="js/lib/jquery.min.js"></script>-->

<script src="../js/lib/NoSleep.min.js"></script>
<script src="../js/base.js"></script>
<script src="../js/lib/bootstrap.min.js"></script>
<script src="../js/lib/bootstrap-table.min.js"></script>
<script src="../js/cookie_plugin.js"></script>
<!--<script src="http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>-->
</body>
</html>
